{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\system/assets\\scripts\\battle\\system\\PlayerDistanceSystem.js"],"names":["PlayerDistanceSystem","cc","Class","extends","Component","properties","players","blocks","knives","cleanUp","init","entityPlayers","localPlayer","entityBlocks","entityKnives","player","push","block","knife","updateGameLogic","dt","isDead","isLocal","aiMgr","other","firstDead","attackRect","intersects","defenceRect","getRect","addNearOther","leaveOther","defenceRects","rect","addNearBlock","node","teamID","addNearKnife"],"mappings":"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","file":"PlayerDistanceSystem.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\system","sourcesContent":["/**\n * @fileoverview PlayerDistanceSystem 每帧根据各个玩家的位置判断是否离得太近\n * @author meifan@gameley.cn (梅凡)\n */\n\n\nconst PlayerDistanceSystem = cc.Class({\n   extends: cc.Component,\n\n    properties: {\n        players: [],\n        blocks: [],\n        knives: [],\n    },\n\n    cleanUp: function () {\n        this.players = [];\n        this.blocks = [];\n        this.knives = [];\n    },\n\n    init: function (entityPlayers, localPlayer, entityBlocks, entityKnives) {\n        for(var player of entityPlayers) {\n            this.players.push(player);\n        }\n        for(var block of entityBlocks) {\n            this.blocks.push(block);\n        }\n        for(var knife of entityKnives) {\n            this.knives.push(knife);\n        }\n        this.localPlayer = localPlayer;\n    },\n\n    updateGameLogic(dt) {\n        // 检测与其他玩家的碰撞\n        var player = null;\n        for(player of this.players) {\n            if(player.isDead) {\n                continue;\n            }\n            if(player.isLocal) {\n                continue;\n            }\n            if(!player.aiMgr) {\n                continue;\n            }\n\n            for(var other of this.players) {\n                if(other === player) {\n                    continue;\n                }\n                if(other.isDead) {\n                    continue;\n                }\n                if(other.firstDead) {\n                    continue;\n                }\n                if(other.isLocal) {\n                    if(player.attackRect.intersects(other.defenceRect.getRect())) {\n                        player.aiMgr.addNearOther(other);\n                    } else {\n                        player.aiMgr.leaveOther(other);\n                    }\n                    continue;\n                }\n                \n                if(player.defenceRect.intersects(other.defenceRect.getRect())) {\n                    player.aiMgr.addNearOther(other);\n                }\n            }\n        }\n\n        for(player of this.players) {\n            if(player.isDead) {\n                continue;\n            }\n            if(player.isLocal) {\n                continue;\n            }\n            if(!player.aiMgr) {\n                continue;\n            }\n\n            for(var block of this.blocks) {\n\n                for(var rect of block.defenceRects) {\n                    if(player.defenceRect.intersects(rect.getRect())) {\n                        player.aiMgr.addNearBlock(rect.node);\n                    }\n                }\n            }\n        }\n\n        for(player of this.players) {\n            if(player.isDead) {\n                continue;\n            }\n            if(player.isLocal) {\n                continue;\n            }\n            if(!player.aiMgr) {\n                continue;\n            }\n\n            for(var knife of this.knives) {\n                if(knife.teamID > 0) {\n                    continue;\n                }\n\n                if(player.attackRect.intersects(knife.defenceRect.getRect())) {\n                    player.aiMgr.addNearKnife(knife);\n                    continue;\n                }\n                \n            }\n        }\n    }\n});"]}