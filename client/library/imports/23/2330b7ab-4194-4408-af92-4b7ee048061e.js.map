{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\knife\\ctrl/assets\\scripts\\battle\\component\\knife\\ctrl\\KnifeSkinCtrl.js"],"names":["KnifeState","require","cc","Class","extends","Component","properties","onLoad","knifeStateComp","node","parent","getComponent","knifeOwnerComp","on","changeSkin","updateLogic","dt","isDirty","owner","player","skin","sprite","Sprite","loader","loadRes","url","SpriteFrame","error","resource","spriteFrame"],"mappings":";;;;;;AAAA;;;;;AAKA,IAAMA,aAAaC,QAAQ,OAAR,EAAiBD,UAApC;AACAE,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY,EAHP;;AAOLC,YAAQ,kBAAY;AAChB,aAAKC,cAAL,GAAsB,KAAKC,IAAL,CAAUC,MAAV,CAAiBC,YAAjB,CAA8B,qBAA9B,CAAtB;AACA,aAAKC,cAAL,GAAsB,KAAKH,IAAL,CAAUC,MAAV,CAAiBC,YAAjB,CAA8B,qBAA9B,CAAtB;AACA,aAAKF,IAAL,CAAUI,EAAV,CAAa,YAAb,EAA2B,KAAKC,UAAhC,EAA4C,IAA5C;AACH,KAXI;AAYLC,iBAAa,qBAAUC,EAAV,EAAc;AACvB,YAAI,CAAC,KAAKR,cAAV,EAA0B,KAAKA,cAAL,GAAsB,KAAKC,IAAL,CAAUC,MAAV,CAAiBC,YAAjB,CAA8B,qBAA9B,CAAtB;AAC1B,YAAI,CAAC,KAAKC,cAAV,EAA0B,KAAKA,cAAL,GAAsB,KAAKH,IAAL,CAAUC,MAAV,CAAiBC,YAAjB,CAA8B,qBAA9B,CAAtB;;AAE1B;AACA,YAAI,KAAKC,cAAL,CAAoBK,OAAxB,EAAiC;AAC7B,iBAAKH,UAAL;AACH;AACJ,KApBI;;AAsBLA,gBAAY,sBAAY;AACpB,YAAI,KAAKF,cAAL,CAAoBM,KAAxB,EAA+B;AAC3B,gBAAI,KAAKN,cAAL,CAAoBM,KAApB,CAA0BP,YAA1B,CAAuC,oBAAvC,CAAJ,EAAkE;AAC9D,oBAAIQ,SAAS,KAAKP,cAAL,CAAoBM,KAApB,CAA0BP,YAA1B,CAAuC,oBAAvC,EAA6DQ,MAA1E;AACA,oBAAIA,OAAOC,IAAX,EAAiB;AACb,wBAAIC,SAAS,KAAKZ,IAAL,CAAUE,YAAV,CAAuBT,GAAGoB,MAA1B,CAAb;AACApB,uBAAGqB,MAAH,CAAUC,OAAV,CAAkBL,OAAOC,IAAP,CAAYK,GAA9B,EAAmCvB,GAAGwB,WAAtC,EAAmD,UAACC,KAAD,EAAQC,QAAR,EAAqB;AACpE,4BAAID,KAAJ,EAAW;AACPzB,+BAAGyB,KAAH,CAASA,KAAT;AACH,yBAFD,MAEO,IAAIC,QAAJ,EAAc;AACjB,gCAAIP,OAAOZ,IAAX,EAAiB;AACbY,uCAAOQ,WAAP,GAAqBD,QAArB;AACH;AACJ;AACJ,qBARD;AASH;AACJ;AACJ;AACJ;AACD;AAzCK,CAAT","file":"KnifeSkinCtrl.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\knife\\ctrl","sourcesContent":["/**\r\n * @fileoverview 刀的皮肤控制\r\n * @author zhangzhuang@gameley.cn (张庄)\r\n */\r\n\r\nconst KnifeState = require('Types').KnifeState;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.knifeStateComp = this.node.parent.getComponent('KnifeStateComponent');\r\n        this.knifeOwnerComp = this.node.parent.getComponent('KnifeOwnerComponent');\r\n        this.node.on('changeSkin', this.changeSkin, this);\r\n    },\r\n    updateLogic: function (dt) {\r\n        if (!this.knifeStateComp) this.knifeStateComp = this.node.parent.getComponent('KnifeStateComponent');\r\n        if (!this.knifeOwnerComp) this.knifeOwnerComp = this.node.parent.getComponent('KnifeOwnerComponent');\r\n\r\n        //根据组件的状态做逻辑处理\r\n        if (this.knifeOwnerComp.isDirty) {\r\n            this.changeSkin()\r\n        }\r\n    },\r\n\r\n    changeSkin: function () {\r\n        if (this.knifeOwnerComp.owner) {\r\n            if (this.knifeOwnerComp.owner.getComponent('EntityFollowPlayer')) {\r\n                var player = this.knifeOwnerComp.owner.getComponent('EntityFollowPlayer').player;\r\n                if (player.skin) {\r\n                    var sprite = this.node.getComponent(cc.Sprite);\r\n                    cc.loader.loadRes(player.skin.url, cc.SpriteFrame, (error, resource) => {\r\n                        if (error) {\r\n                            cc.error(error);\r\n                        } else if (resource) {\r\n                            if (sprite.node) {\r\n                                sprite.spriteFrame = resource;\r\n                            }\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // update (dt) {},\r\n});"]}