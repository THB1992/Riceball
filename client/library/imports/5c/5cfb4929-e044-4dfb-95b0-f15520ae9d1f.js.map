{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\data\\singleton/assets\\scripts\\data\\singleton\\GameData.js"],"names":["Tools","require","Environment","GameData","cc","Class","statics","instance","init","cleanUp","properties","mapWidth","mapHeight","_vibrateOpen","_audioOpen","logicFps","gameTime","initMapScreenNum","localHeroTid","screenWidth","screenHeight","designSize","size","fatSize","isFitHeight","isLowHeight","screenSize","knifeMin","knifeMax","speedRate","clientVersion","clientVersionCode","isInReview","resVersion","srcVersion","environment","Publish","frameSize","view","getFrameSize","getVisibleSizeInPixel","canvas","find","width","height","ratio","screenOffset","realRatio","designRatio","fatRatio","isFloatEqual","console","log","gameData","getItem","data","JSON","parse","showVersion","Number","parseInt","isShowLog","isEnvironmentTest","Test","Develop","isEnvironmentPublish","Trial","isEnvironmentCheckUpdate","CC_DEBUG","sys","isNative","setAudio","isOpen","saveGameData","setVibrate","setItem","stringify","logUseTime","scene","_curTime","now","getTimestampMS","isPad","isLongScreen"],"mappings":"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","file":"GameData.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\data\\singleton","sourcesContent":["/**\n * @fileoverview 游戏数据\n * @author meifan@gameley.cn (梅凡)\n */\n\nconst Tools = require('Tools');\nconst Environment = require('Types').Environment;\n\nvar GameData = cc.Class({\n    statics: {\n        instance: null,\n        init: function () {\n            if (GameData.instance === null) {\n                GameData.instance = new GameData();\n                GameData.instance.init();\n            }\n        },\n        cleanUp: function () {\n            if (GameData.instance) {\n                Tools.cleanUp(GameData.instance);\n            }\n            GameData.instance = null;\n        }\n    },\n\n    properties: {\n        mapWidth: 3600,\n        mapHeight: 6400,\n        _vibrateOpen: true,\n        _audioOpen: true,\n        logicFps: 60,\n        gameTime: 30,\n        initMapScreenNum: 7,\n        localHeroTid: 1,\n        screenWidth: 720,\n        screenHeight: 1280,\n        designSize: cc.size(720, 1280),\n\n        fatSize: cc.size(720, 1040),\n        isFitHeight: false,\n        isLowHeight: false,\n        screenSize: null,\n        knifeMin: 9,\n        knifeMax: 20,\n        speedRate: 1.0,\n        clientVersion: '0',\n        clientVersionCode: 0,\n        isInReview: false,\n        /** 资源版本号，用于资源更新 */\n        resVersion: 0,\n        /** JS资源版本号，用于JS资源更新 */\n        srcVersion: null,\n        /** @type {Environment} 环境 */\n        environment: Environment.Publish,\n    },\n\n    init: function () {\n        this.initMapScreenNum = 7;\n        this.mapWidth = 720 * this.initMapScreenNum;\n        this.mapHeight = 720 * this.initMapScreenNum;\n        this.frameSize = cc.view.getFrameSize();\n        this.screenSize = cc.view.getVisibleSizeInPixel();\n        var canvas = cc.find(\"Canvas\");\n        this.screenWidth = canvas.width;\n        this.screenHeight = canvas.width * this.frameSize.height / this.frameSize.width;\n        this.ratio = this.frameSize.width / this.screenWidth;\n        this.screenOffset = (1280 - this.screenHeight) / 2;\n\n        const realRatio = this.frameSize.height * 1.0 / this.frameSize.width;\n        const designRatio = this.designSize.height * 1.0 / this.designSize.width;\n        const fatRatio = this.fatSize.height * 1.0 / this.fatSize.width;\n        if (!Tools.isFloatEqual(realRatio, designRatio)) {\n            this.isFitHeight = realRatio > designRatio;\n            this.isLowHeight = realRatio < fatRatio;\n        }\n\n        console.log('ratio: ' + this.ratio);\n        console.log('screen: ' + this.screenWidth, this.screenHeight);\n        console.log('frameSize: ' + this.frameSize);\n        console.log('screensize: ' + this.screenSize);\n\n        var gameData = Tools.getItem('gameData');\n        if (gameData) {\n            var data = JSON.parse(gameData);\n            this._vibrateOpen = data._vibrateOpen; //Tools.getItem('VibrateOpen'); 后续改为开关\n            this._audioOpen = data._audioOpen;\n        } else {\n            this._vibrateOpen = true; //Tools.getItem('VibrateOpen'); 后续改为开关\n            this._audioOpen = true;\n        }\n\n\n        this.logicFps = 60;\n        this.gameTime = 90;\n        this.localHeroTid = 1;\n        this.knifeMin = 9;\n        this.knifeMax = 20;\n        this.speedRate = 1.0;\n        \n        this.showVersion = 'v1.0.18';\n        this.clientVersion = '10018';\n        this.resVersion = 6;\n        this.srcVersion = this.resVersion;\n        this.clientVersionCode = Number.parseInt(this.clientVersion);\n        this.isInReview = false;\n        //  Test  QA  Publish  Develop  Trial\n        this.environment = Environment.Publish;\n        // this.environment = Environment.Test;\n\n    },\n\n    isShowLog: function () {\n        return this.isEnvironmentTest();\n    },\n\n    isEnvironmentTest: function () {\n        return this.environment === Environment.Test || this.environment === Environment.Develop;\n    },\n\n    isEnvironmentPublish: function () {\n        return this.environment === Environment.Publish || this.environment === Environment.Trial;\n    },\n\n    /** \n     * 当前环境是否检查资源更新\n     * 注意：调试模式因为BUILD后的文件结构及资源加载逻辑不同，故不开启资源更新 \n     * */\n    isEnvironmentCheckUpdate: function () {\n        return (!CC_DEBUG || cc.sys.isNative); // && (this.environment === Environment.Publish || this.environment === Environment.QA);\n    },\n\n    setAudio: function (isOpen) {\n        GameData.instance._audioOpen = isOpen;\n        this.saveGameData();\n    },\n\n    setVibrate: function (isOpen) {\n        GameData.instance._vibrateOpen = isOpen;\n        this.saveGameData();\n    },\n\n    saveGameData: function () {\n        var gameData = {\n            _vibrateOpen: this._vibrateOpen,\n            _audioOpen: this._audioOpen,\n        }\n        Tools.setItem('gameData', JSON.stringify(gameData));\n    },\n\n    logUseTime: function (scene) {\n        if (this._curTime && this.isShowLog()) {\n            const now = Tools.getTimestampMS();\n            console.log(scene + '用时: ' + (now - this._curTime) + ' ms');\n            this._curTime = now;\n        }\n    },\n\n\n    isPad: function () {\n        return this.screenHeight < 1200 || this.screenHeight / this.screenWidth < 16 / 9;\n    },\n\n\n    isLongScreen: function () {\n        return this.screenHeight > 1300 || this.screenHeight / this.screenWidth > 16 / 9;\n    }\n\n});"]}