{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\move/assets\\scripts\\battle\\component\\move\\MoveByTouch.js"],"names":["Tools","require","MoveByTouch","cc","Class","extends","Component","properties","onLoad","node","on","Node","EventType","TOUCH_START","_touchStartEvent","TOUCH_MOVE","_touchMoveEvent","TOUCH_END","touchEndEvent","TOUCH_CANCEL","init","target","_target","event","enabled","startPos","getLocation","emit","beginMove","curPos","dPos","sub","magSqr","compareVec2","curDir","normalize","update","dt"],"mappings":";;;;;;AAAA;;;;;AAKA,IAAMA,QAAQC,QAAQ,OAAR,CAAd;;AAEA,IAAMC,cAAcC,GAAGC,KAAH,CAAS;AACzBC,aAASF,GAAGG,SADa;;AAGzBC,gBAAY,EAHa;;AAOzBC,YAAQ,kBAAY;;AAEhB,aAAKC,IAAL,CAAUC,EAAV,CAAaP,GAAGQ,IAAH,CAAQC,SAAR,CAAkBC,WAA/B,EAA4C,KAAKC,gBAAjD,EAAmE,IAAnE;AACA,aAAKL,IAAL,CAAUC,EAAV,CAAaP,GAAGQ,IAAH,CAAQC,SAAR,CAAkBG,UAA/B,EAA2C,KAAKC,eAAhD,EAAiE,IAAjE;AACA,aAAKP,IAAL,CAAUC,EAAV,CAAaP,GAAGQ,IAAH,CAAQC,SAAR,CAAkBK,SAA/B,EAA0C,KAAKC,aAA/C,EAA8D,IAA9D;AACA,aAAKT,IAAL,CAAUC,EAAV,CAAaP,GAAGQ,IAAH,CAAQC,SAAR,CAAkBO,YAA/B,EAA6C,KAAKD,aAAlD,EAAiE,IAAjE;AAEH,KAdwB;;AAgBzBE,UAAM,cAAUC,MAAV,EAAkB;AACpB,aAAKC,OAAL,GAAeD,OAAOZ,IAAtB;AACH,KAlBwB;;AAoBzBK,sBAAmB,0BAAUS,KAAV,EAAiB;AAChC,YAAG,CAAC,KAAKC,OAAT,EAAiB;AACjB,aAAKC,QAAL,GAAgBF,MAAMG,WAAN,EAAhB;AACA,aAAKJ,OAAL,CAAaK,IAAb,CAAkB,eAAlB;AACA,aAAKC,SAAL,GAAiB,KAAjB;AACH,KAzBwB;;AA2BzBZ,qBAAkB,yBAAUO,KAAV,EAAiB;AAC/B,YAAMM,SAASN,MAAMG,WAAN,EAAf;AACA,YAAII,OAAOD,OAAOE,GAAP,CAAW,KAAKN,QAAhB,CAAX;AACA;AACA,YAAGK,KAAKE,MAAL,KAAgB,GAAnB,EAAwB;AACpB,iBAAKJ,SAAL,GAAiB,IAAjB;AACH;AACD,YAAG5B,MAAMiC,WAAN,CAAkBJ,MAAlB,EAA0B,KAAKJ,QAA/B,CAAH,EAA6C;AACzC,iBAAKS,MAAL,GAAc,IAAd;AACH,SAFD,MAEO;AACH,iBAAKA,MAAL,GAAcL,OAAOE,GAAP,CAAW,KAAKN,QAAhB,EAA0BU,SAA1B,EAAd;AACH;AACJ,KAvCwB;;AAyCzBjB,mBAAgB,uBAAUK,KAAV,EAAiB;AAC7B,aAAKD,OAAL,CAAaK,IAAb,CAAkB,cAAlB;AACA,aAAKO,MAAL,GAAc,IAAd;AACA,aAAKN,SAAL,GAAiB,KAAjB;AACH,KA7CwB;;AA+CzBQ,YAAQ,gBAAUC,EAAV,EAAc;AAClB,YAAG,KAAKH,MAAL,IAAe,KAAKN,SAAvB,EAAkC;AAC9B,iBAAKN,OAAL,CAAaK,IAAb,CAAkB,UAAlB,EAA8B;AAC1BG,sBAAM,KAAKI;AADe,aAA9B;AAGH;AACJ;;AArDwB,CAAT,CAApB","file":"MoveByTouch.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\move","sourcesContent":["/**\n * @fileoverview 移动触屏控制器\n * @author meifan@gameley.cn (梅凡)\n */\n\nconst Tools = require('Tools');\n\nconst MoveByTouch = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    onLoad: function () {\n        \n        this.node.on(cc.Node.EventType.TOUCH_START, this._touchStartEvent, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._touchMoveEvent, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.touchEndEvent, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.touchEndEvent, this);\n\n    },\n\n    init: function (target) {\n        this._target = target.node;\n    },\n\n    _touchStartEvent : function (event) {\n        if(!this.enabled)return;\n        this.startPos = event.getLocation();\n        this._target.emit('heroMoveStart');\n        this.beginMove = false;\n    },\n\n    _touchMoveEvent : function (event) {\n        const curPos = event.getLocation();\n        var dPos = curPos.sub(this.startPos);\n        // console.log('dPos.magSqr: ' + dPos.magSqr() + ' , curPos: ' + curPos + ', startPos: ' + this.startPos);\n        if(dPos.magSqr() > 100) {\n            this.beginMove = true;\n        }\n        if(Tools.compareVec2(curPos, this.startPos)) {\n            this.curDir = null;\n        } else {\n            this.curDir = curPos.sub(this.startPos).normalize();\n        }\n    },\n\n    touchEndEvent : function (event) {\n        this._target.emit('onStopMoving');\n        this.curDir = null;\n        this.beginMove = false;\n    },\n\n    update: function (dt) {\n        if(this.curDir && this.beginMove) {\n            this._target.emit('onMoveBy', {\n                dPos: this.curDir\n            });\n        }\n    }\n\n});"]}