{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui/assets\\scripts\\battle\\ui\\PanelRevive.js"],"names":["Tools","require","ConfigData","PlayerData","ShareMgr","ShareType","AdvertMgr","AdverType","GameData","StageType","PlatformMgr","cc","Class","extends","Component","properties","timeLabel","Label","reviveBtn","Node","bornAndFrenzyIcon","bornIcon","adverIcon","shareIcon","baozouEffect","textNode","baozouAnim","Animation","init","callback","reviveCount","GSGame","startUpdate","time","x","stage","instance","getCurStageByPrizeCount","openPanelKeyCount","isApp","lastRevieAdFail","clientData","adverReviveFailToShare","isShowLog","console","log","Share","Free","active","Adver","func","hasAdver","openAdver","Revive","panelTop","getComponent","_time","loadAdver","canFrenzy","animState","play","speed","onReviveFrenzyBtnClick","self","closeFunc","success","close","showShare","showAdver","errFunc","fireBaseEvent","getAdvertUnitId","tipsFunc","isSuccess","tips","shareFailTips","str","getUITipStr","getRandomItem","showTips","share","update","dt","Math","floor","string","node"],"mappings":"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","file":"PanelRevive.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui","sourcesContent":["const Tools = require('Tools');\r\nconst ConfigData = require('ConfigData');\r\nconst PlayerData = require('PlayerData');\r\nconst ShareMgr = require('ShareMgr');\r\nconst ShareType = require('Types').ShareType;\r\nconst AdvertMgr = require('AdvertMgr');\r\nconst AdverType = require('Types').AdverType;\r\nconst GameData = require('GameData');\r\nconst StageType = require('Types').StageType;\r\nconst PlatformMgr = require('PlatformMgr');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        timeLabel: cc.Label,\r\n        reviveBtn: cc.Node,\r\n        bornAndFrenzyIcon: cc.Node,\r\n        bornIcon: cc.Node,\r\n        adverIcon: cc.Node,\r\n        shareIcon: cc.Node,\r\n\r\n        baozouEffect: cc.Node,\r\n\r\n        textNode: cc.Node,\r\n        baozouAnim: cc.Animation,\r\n    },\r\n\r\n\r\n    init: function (callback, reviveCount, GSGame) {\r\n        this.GSGame = GSGame;\r\n        this.callback = callback;\r\n        this.startUpdate = true;\r\n        this.time = 5;\r\n        this.textNode.x = 0;\r\n        // var stage = ConfigData.instance.getCurStage(PlayerData.instance.playCount, ConfigData.instance.clientData.adverReviveLimit);\r\n        var stage = ConfigData.instance.getCurStageByPrizeCount(PlayerData.instance);\r\n        this.GSGame.openPanelKeyCount(true);\r\n\r\n\r\n        if (!PlatformMgr.isApp() && PlayerData.instance.lastRevieAdFail && ConfigData.instance.clientData.adverReviveFailToShare) {\r\n            if (GameData.instance.isShowLog()) {\r\n                console.log('上次复活视频观看失败，本次强制分享')\r\n            }\r\n\r\n            stage = StageType.Share;\r\n            PlayerData.instance.lastRevieAdFail = false;\r\n        }\r\n\r\n\r\n        switch (stage) {\r\n            case StageType.Free:\r\n                this.adverIcon.active = false;\r\n                this.shareIcon.active = false;\r\n                this.textNode.x = -20;\r\n                break;\r\n            case StageType.Share:\r\n                this.adverIcon.active = false;\r\n                this.shareIcon.active = true;\r\n                break;\r\n            case StageType.Adver:\r\n                PlayerData.instance.lastRevieAdFail = true;\r\n                var func = (hasAdver) => {\r\n                    this.adverIcon.active = hasAdver;\r\n                    this.shareIcon.active = !hasAdver;\r\n\r\n                    if (hasAdver) {\r\n                        AdvertMgr.instance.openAdver(AdverType.Revive);\r\n                    }\r\n                }\r\n\r\n                if (!PlatformMgr.isApp() && this.GSGame.panelTop.getComponent('PanelTop')._time < 20) {\r\n                    func(false)\r\n                } else {\r\n                    AdvertMgr.instance.loadAdver(AdverType.Revive, func);\r\n                }\r\n                break;\r\n        }\r\n\r\n\r\n        // var canFrenzy = PlayerData.instance.rankData.id >= ConfigData.instance.clientData.frenzyLimit;\r\n        var canFrenzy = true;\r\n        this.bornAndFrenzyIcon.active = canFrenzy;\r\n        this.bornIcon.active = !canFrenzy;\r\n        this.baozouEffect.active = canFrenzy;\r\n        var animState = this.baozouAnim.play();\r\n        animState.speed = 0.2;\r\n        // AdvertMgr.instance.showBanner();\r\n    },\r\n\r\n    //暴走复活\r\n    onReviveFrenzyBtnClick: function () {\r\n        this.startUpdate = false;\r\n        var self = this;\r\n        var closeFunc = (success) => {\r\n            if (success && self.callback) {\r\n                PlayerData.instance.lastRevieAdFail = false;\r\n                if (self.callback) self.callback(true, this.bornAndFrenzyIcon.active);\r\n                // AdvertMgr.instance.destoryBanner();\r\n                self.close()\r\n            } else {\r\n                self.startUpdate = true;\r\n            }\r\n        }\r\n\r\n        if (this.shareIcon.active) {\r\n            this.showShare(closeFunc);\r\n        } else if (this.adverIcon.active) {\r\n            this.showAdver(closeFunc);\r\n        } else {\r\n            closeFunc(true);\r\n        }\r\n    },\r\n\r\n\r\n    showAdver: function (closeFunc) {\r\n        var self = this;\r\n        var errFunc = () => {\r\n            self.showShare(closeFunc);\r\n        }\r\n        AdvertMgr.instance.showAdver(AdverType.Revive, closeFunc, errFunc);\r\n        AdvertMgr.instance.fireBaseEvent(\"click_adv_btn\",\"position_id\",ConfigData.instance.getAdvertUnitId(AdverType.Revive));\r\n    },\r\n\r\n    showShare: function (closeFunc) {\r\n        var self = this;\r\n        var tipsFunc = (isSuccess) => {\r\n            var tips = ConfigData.instance.clientData.shareFailTips;\r\n            var str = isSuccess ? ConfigData.instance.getUITipStr(1) : Tools.getRandomItem(tips);\r\n            self.GSGame.showTips(str);\r\n        }\r\n        ShareMgr.share(ShareType.Revive, closeFunc, tipsFunc);\r\n    },\r\n\r\n    update(dt) {\r\n        if (this.startUpdate) {\r\n            this.time -= dt;\r\n            var str = Math.floor(this.time);\r\n            if (this.timeLabel.string !== str) {\r\n                this.timeLabel.string = str;\r\n            }\r\n\r\n            if (this.time < 0) {\r\n                this.time = 5;\r\n                this.startUpdate = false;\r\n                this.callback(false);\r\n                // AdvertMgr.instance.destoryBanner();\r\n                this.close()\r\n            }\r\n        }\r\n    },\r\n\r\n    close() {\r\n        this.node.active = false;\r\n        this.GSGame.openPanelKeyCount(false);\r\n    }\r\n});"]}