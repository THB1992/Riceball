{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui/assets\\scripts\\battle\\ui\\PanelLevelUp.js"],"names":["UIUtil","require","ConfigData","PlayerData","PlatformMgr","AdvertMgr","Tools","ShareMgr","ShareType","CustomFunnelEvent","cc","Class","extends","Component","properties","levelUpAnim","Animation","goldLabel","Label","rankLabel","confirmBtn","Node","panelNode","oldRankIcon","Sprite","midRankIcon","newRankIcon","time","unlockBuffNode","unlockBuffLabel","unlockBuffIcon","unlockMapNode","unlockMapLabel","unlockMapIcon","unlockSpecialNode","unlockSpecialLabel","unlockSpecialIcon","unlockBoxNode","unlockBoxLabel","unlockBoxIcon","rankUpSpine","sp","Skeleton","rankUpIconAnim","rankUpEffectAnim","greatLabel","init","callback","oldRank","instance","oldRankData","newRank","rankData","onConfirmBtnClick","showLevelUp","showBanner","string","nextRankData","getRankDataById","id","oldGoldRate","goldMultiRate","newGoldRate","addGoldRate","loadResSprite","url","name","getStringByFormat","getUITipStr","Math","ceil","active","children","iconSpr","getComponent","play","setAnimation","isRankFirst","setTimeout","updateGoldRate","func","unlockBuff","unlockTips","unlockBuffIcons","func2","unlockMap","unlockMapTips","unlockMapIcons","func3","unlockSpecial","unlockSpecialTips","unlockSpecialIcons","unlockBox","unlockBoxTips","unlockBoxIcons","midRankData","update","dt","y","node","isSecGame","notifyFunnelEvent","RankUpEnd","onShareBtnClick","share","LevelUp"],"mappings":"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","file":"PanelLevelUp.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui","sourcesContent":["const UIUtil = require('UIUtil');\r\nconst ConfigData = require('ConfigData');\r\nconst PlayerData = require('PlayerData');\r\nconst PlatformMgr = require('PlatformMgr');\r\nconst AdvertMgr = require('AdvertMgr');\r\nconst Tools = require('Tools');\r\nconst ShareMgr = require('ShareMgr');\r\nconst ShareType = require('Types').ShareType;\r\nconst CustomFunnelEvent = require('Types').CustomFunnelEvent;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n        levelUpAnim: cc.Animation,\r\n        goldLabel: cc.Label,\r\n        rankLabel: cc.Label,\r\n        confirmBtn: cc.Node,\r\n        panelNode: cc.Node,\r\n\r\n        oldRankIcon: cc.Sprite,\r\n        midRankIcon: cc.Sprite,\r\n        newRankIcon: cc.Sprite,\r\n        time: 0,\r\n\r\n\r\n        unlockBuffNode: cc.Node,\r\n        unlockBuffLabel: cc.Label,\r\n        unlockBuffIcon: cc.Node,\r\n\r\n\r\n        unlockMapNode: cc.Node,\r\n        unlockMapLabel: cc.Label,\r\n        unlockMapIcon: cc.Node,\r\n\r\n        unlockSpecialNode: cc.Node,\r\n        unlockSpecialLabel: cc.Label,\r\n        unlockSpecialIcon: cc.Node,\r\n\r\n\r\n        unlockBoxNode: cc.Node,\r\n        unlockBoxLabel: cc.Label,\r\n        unlockBoxIcon: cc.Node,\r\n\r\n        rankUpSpine: sp.Skeleton,\r\n        rankUpIconAnim: cc.Animation,\r\n        rankUpEffectAnim: cc.Animation,\r\n\r\n        //language\r\n        greatLabel: cc.Label,\r\n    },\r\n\r\n    init: function (callback) {\r\n        this.callback = callback;\r\n        var oldRank = PlayerData.instance.oldRankData;\r\n        var newRank = PlayerData.instance.rankData;\r\n        if (!oldRank || !newRank) {\r\n            this.onConfirmBtnClick();\r\n            return;\r\n        }\r\n\r\n        this.oldRank = oldRank;\r\n        this.newRank = newRank;\r\n        this.showLevelUp();\r\n        AdvertMgr.instance.showBanner();\r\n\r\n        this.greatLabel.string = 'Great!';\r\n    },\r\n\r\n\r\n    showLevelUp: function () {\r\n        this.nextRankData = ConfigData.instance.getRankDataById(this.newRank.id);\r\n        this.oldGoldRate = this.oldRank.goldMultiRate * 100 + 100;\r\n        this.newGoldRate = this.nextRankData.goldMultiRate * 100 + 100;\r\n        this.addGoldRate = this.newGoldRate - this.oldGoldRate;\r\n        UIUtil.loadResSprite(this.oldRankIcon, this.oldRank.url);\r\n        // AddEntitySystem.instance.loadRankSprite(this.oldRankIcon, this.oldRank.iconIndex);\r\n        UIUtil.loadResSprite(this.newRankIcon, this.nextRankData.url);\r\n        // AddEntitySystem.instance.loadRankSprite(this.newRankIcon, this.nextRankData.iconIndex);\r\n        this.rankLabel.string = this.oldRank.name;\r\n        // this.goldLabel.string = '' + + '%';\r\n        this.goldLabel.string = Tools.getStringByFormat(ConfigData.instance.getUITipStr(13), Math.ceil(this.oldGoldRate));\r\n        // this.levelUpAnim.on('stop', () => {\r\n        //     this.updateGoldRate = true;\r\n        // }, this)\r\n        this.confirmBtn.active = false;\r\n\r\n        this.unlockBuffNode.active = false;\r\n        this.unlockMapNode.active = false;\r\n        this.unlockSpecialNode.active = false;\r\n        this.unlockBoxNode.active = false;\r\n\r\n        for (var iconSpr of this.unlockBuffIcon.children) {\r\n            iconSpr.active = false;\r\n        }\r\n        for (var iconSpr of this.unlockMapIcon.children) {\r\n            iconSpr.active = false;\r\n        }\r\n        for (var iconSpr of this.unlockSpecialIcon.children) {\r\n            iconSpr.active = false;\r\n        }\r\n        for (var iconSpr of this.unlockBoxIcon.children) {\r\n            iconSpr.active = false;\r\n        }\r\n\r\n\r\n        this.panelNode.getComponent(cc.Animation).play('ani-levelUpNode');\r\n\r\n\r\n        if (this.newRank.id - this.oldRank.id === 1) {\r\n            this.rankUpSpine.setAnimation(1, 'rankup-begin');\r\n            this.rankUpIconAnim.play();\r\n\r\n            if (this.newRank.isRankFirst) {\r\n                this.rankUpEffectAnim.play('effect-rankup-plus');\r\n            } else {\r\n                this.rankUpEffectAnim.play('effect-rankup');\r\n            }\r\n\r\n\r\n\r\n            setTimeout(() => {\r\n                this.levelUpAnim.play('ani-levelUp');\r\n            }, 1000);\r\n\r\n            setTimeout(() => {\r\n                this.rankUpSpine.setAnimation(1, 'rankup-keep', true);\r\n                this.rankUpEffectAnim.play('effect-rankup-keep');\r\n            }, 2500);\r\n\r\n            setTimeout(() => {\r\n                if (this.rankLabel)\r\n                    this.rankLabel.string = this.nextRankData.name;\r\n            }, 1700);\r\n\r\n            setTimeout(() => {\r\n                this.updateGoldRate = true;\r\n            }, 2166);\r\n\r\n            setTimeout(() => {\r\n                var func = () => {\r\n                    if (this.newRank.unlockBuff || this.newRank.unlockBuff === 0) {\r\n                        this.unlockBuffLabel.string = this.newRank.unlockTips;\r\n                        var unlockBuffIcons = this.unlockBuffIcon.children;\r\n                        unlockBuffIcons[this.newRank.unlockBuff].active = true;\r\n                        this.unlockBuffNode.active = true;\r\n                    }\r\n                }\r\n\r\n                var func2 = () => {\r\n                    if (this.newRank.unlockMap || this.newRank.unlockMap === 0) {\r\n                        this.unlockMapNode.active = true;\r\n                        this.unlockMapLabel.string = this.newRank.unlockMapTips;\r\n                        var unlockMapIcons = this.unlockMapIcon.children;\r\n                        unlockMapIcons[this.newRank.unlockMap].active = true;\r\n                        setTimeout(() => {\r\n                            func();\r\n                        }, 200)\r\n                    } else {\r\n                        func();\r\n                    }\r\n                }\r\n\r\n                var func3 = () => {\r\n                    if (this.newRank.unlockSpecial || this.newRank.unlockSpecial === 0) {\r\n                        this.unlockSpecialNode.active = true;\r\n                        this.unlockSpecialLabel.string = this.newRank.unlockSpecialTips;\r\n                        var unlockSpecialIcons = this.unlockSpecialIcon.children;\r\n                        unlockSpecialIcons[this.newRank.unlockSpecial].active = true;\r\n                        setTimeout(() => {\r\n                            func2();\r\n                        }, 200)\r\n                    } else {\r\n                        func2();\r\n                    }\r\n                }\r\n\r\n                if (this.newRank.unlockBox || this.newRank.unlockBox === 0) {\r\n                    this.unlockBoxNode.active = true;\r\n                    this.unlockBoxLabel.string = this.newRank.unlockBoxTips;\r\n                    var unlockBoxIcons = this.unlockBoxIcon.children;\r\n                    unlockBoxIcons[this.newRank.unlockBox].active = true;\r\n                    setTimeout(() => {\r\n                        func3();\r\n                    }, 200)\r\n                } else {\r\n                    func3();\r\n                }\r\n\r\n\r\n            }, 2166);\r\n        } else {\r\n\r\n            var midRankData = ConfigData.instance.getRankDataById(this.oldRank.id + 1)\r\n            UIUtil.loadResSprite(this.midRankIcon, midRankData.url);\r\n            // AddEntitySystem.instance.loadRankSprite(this.midRankIcon, midRankData.iconIndex);\r\n            setTimeout(() => {\r\n                this.levelUpAnim.play('ani-levelUp-2');\r\n            }, 1000);\r\n            setTimeout(() => {\r\n                if (this.rankLabel)\r\n                    this.rankLabel.string = midRankData.name;\r\n            }, 1700);\r\n\r\n            setTimeout(() => {\r\n                if (this.rankLabel)\r\n                    this.rankLabel.string = this.nextRankData.name;\r\n            }, 2400);\r\n            setTimeout(() => {\r\n                this.updateGoldRate = true;\r\n            }, 3000);\r\n        }\r\n        // this.panelNode.scale = 0;\r\n        // this.panelNode.runAction(cc.scaleTo(0.3, 1));\r\n    },\r\n\r\n    update: function (dt) {\r\n        if (this.updateGoldRate) {\r\n            // this.time += dt;\r\n            // if (this.time > 0.03) {\r\n            //     this.time = 0;\r\n            // if (this.oldGoldRate < this.newGoldRate) {\r\n            //     this.oldGoldRate += this.addGoldRate / 10;\r\n            // this.goldLabel.string = 'Rank bonus coin:' + Math.ceil(this.newGoldRate) + '%';\r\n            this.goldLabel.string = Tools.getStringByFormat(ConfigData.instance.getUITipStr(13), Math.ceil(this.newGoldRate));\r\n            // } else {\r\n            this.updateGoldRate = false;\r\n            this.confirmBtn.y = -68;\r\n            if (this.newRank.unlockBuff || this.newRank.unlockBuff === 0) {\r\n                this.confirmBtn.y -= 60;\r\n            }\r\n            if (this.newRank.unlockMap || this.newRank.unlockMap === 0) {\r\n                this.confirmBtn.y -= 60;\r\n            }\r\n            if (this.newRank.unlockSpecial || this.newRank.unlockSpecial === 0) {\r\n                this.confirmBtn.y -= 60;\r\n            }\r\n            if (this.newRank.unlockBox || this.newRank.unlockBox === 0) {\r\n                this.confirmBtn.y -= 60;\r\n            }\r\n            // var action = cc.scaleTo(0.1, 1);\r\n            setTimeout(() => {\r\n                this.oldRank = this.nextRankData;\r\n                this.confirmBtn.active = true;\r\n            }, 300);\r\n            // this.goldLabel.node.parent.runAction(action);\r\n            // }\r\n        }\r\n    },\r\n\r\n    onConfirmBtnClick: function () {\r\n        if (this.callback) this.callback();\r\n        this.node.active = false;\r\n        if (PlayerData.instance.isSecGame()) {\r\n            PlatformMgr.notifyFunnelEvent(CustomFunnelEvent.RankUpEnd);\r\n        }\r\n        // AdvertMgr.instance.destoryBanner();\r\n    },\r\n\r\n\r\n    onShareBtnClick: function () {\r\n        ShareMgr.share(ShareType.LevelUp);\r\n    },\r\n});"]}