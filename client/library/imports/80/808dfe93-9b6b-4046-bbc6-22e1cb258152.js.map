{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui/assets\\scripts\\battle\\ui\\PanelRankInfo.js"],"names":["Tools","require","ConfigData","PlayerData","AdvertMgr","AdverType","BagItem","ItemType","ShareMgr","ShareType","cc","Class","extends","Component","properties","itemRankInfo","Prefab","itemStarPrefab","itemRankReward","itemScrollView","ScrollView","content","Node","itemRankParent","itemStarParent","bar","barBg","countNode","countLabel","Label","cubeBgNode","_itemCells","_itemNodes","init","world","itemHeight","rankDatas","instance","starRankDatas","i","length","data","instantiate","parent","x","y","itemRankRewardComp","getComponent","reward","item","createItemWithString","type","HERO_SKIN","KNIFE_SKIN","MONEY","setOnItemClick","levelUpStar","itemStar","isGet","rankStar","star","children","active","rankData","rate","height","id","scrollToOffset","v2","refresh","onScrollView","itemComp","canUnlock","isOwnHeroSkin","isOwnKnifeSkin","arrContains","completeRankRewardIds","onItemClick","event","customEventData","unLockBtnClick","updateGold","num","showGold","addCompleteRankReward","param","count","isMore","isLucky","uiMgr","showGetMoneyEffect","refreshRedDot","self","closeFunc","success","unLockCallback","errFunc","showShare","showAdver","UnlockSkin","share","skinId","addHeroSkin","getHeroSkinById","onEquipHeroSkin","showReward","addKnifeSkin","getKnifeSkinById","onEquipKnifeSkin","curScrollHeight","getScrollOffset","index","Math","floor","unLockNode","string","onCloseBtnClick","node","destoryBanner"],"mappings":"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","file":"PanelRankInfo.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui","sourcesContent":["const Tools = require('Tools');\r\nconst ConfigData = require('ConfigData');\r\nconst PlayerData = require('PlayerData');\r\nconst AdvertMgr = require('AdvertMgr');\r\nconst AdverType = require('Types').AdverType;\r\nconst BagItem = require('BagItem');\r\nconst ItemType = require('Types').ItemType;\r\nconst ShareMgr = require('ShareMgr');\r\nconst ShareType = require('Types').ShareType;\r\n\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        itemRankInfo: cc.Prefab,\r\n        itemStarPrefab: cc.Prefab,\r\n        itemRankReward: cc.Prefab,\r\n        itemScrollView: cc.ScrollView,\r\n        content: cc.Node,\r\n        itemRankParent: cc.Node,\r\n        itemStarParent: cc.Node,\r\n        bar: cc.Node,\r\n        barBg: cc.Node,\r\n        countNode: cc.Node,\r\n        countLabel: cc.Label,\r\n        cubeBgNode: cc.Node,\r\n\r\n        _itemCells: [],\r\n        _itemNodes: [],\r\n    },\r\n\r\n    init: function (world) {\r\n        this.world = world;\r\n        this.itemHeight = 320;\r\n        var rankDatas = ConfigData.instance.starRankDatas;\r\n        for (let i = rankDatas.length - 1; i >= 0; i--) {\r\n            var data = rankDatas[i];\r\n\r\n            //生成段位Item\r\n            if (!this._itemNodes[i]) {\r\n\r\n                let itemRankReward = cc.instantiate(this.itemRankReward);\r\n                itemRankReward.parent = this.itemRankParent;\r\n                itemRankReward.x = 80;\r\n                itemRankReward.y = -135 - this.itemHeight * (rankDatas.length - 1 - i);\r\n                this._itemNodes[i] = itemRankReward;\r\n                var itemRankRewardComp = itemRankReward.getComponent('ItemRankReward');\r\n\r\n                if (data.reward) {\r\n                    var item = BagItem.createItemWithString(data.reward);\r\n                    switch (item.type) {\r\n                        case ItemType.HERO_SKIN:\r\n                        case ItemType.KNIFE_SKIN:\r\n                            itemRankRewardComp.init(data, item, true);\r\n                            break;\r\n                        case ItemType.MONEY:\r\n                            itemRankRewardComp.init(data, item, false);\r\n                            break;\r\n                    }\r\n                } else {\r\n                    itemRankRewardComp.init(data, null, false);\r\n                }\r\n\r\n                this._itemCells[i] = itemRankRewardComp;\r\n                itemRankRewardComp.setOnItemClick(this, itemRankRewardComp);\r\n\r\n                //生成段位星星Item\r\n                if (data.levelUpStar) {\r\n                    for (let i = 1; i <= data.levelUpStar; i++) {\r\n                        let itemStar = cc.instantiate(this.itemStarPrefab);\r\n                        itemStar.parent = this.itemStarParent;\r\n                        itemStar.x = 35;\r\n                        itemStar.y = itemRankReward.y + i * (this.itemHeight / data.levelUpStar);\r\n                        var isGet = PlayerData.instance.rankStar >= data.star + i;\r\n                        itemStar.children[0].active = isGet ? true : false;\r\n                        itemStar.children[1].active = isGet ? false : true;\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n        // var scrollViewCulling = Tools.getOrAddComponent(this.itemScrollView.node, 'ScrollViewCulling');\r\n        // scrollViewCulling.init(this.itemScrollView, this._itemCells, {\r\n        //     countPerLine: 1,\r\n        // });\r\n        var rankData = PlayerData.instance.rankData;\r\n        var star = PlayerData.instance.rankStar;\r\n        var rate = 0\r\n        if (rankData.levelUpStar) {\r\n            var rate = (star - rankData.star) / rankData.levelUpStar;\r\n        }\r\n\r\n        this.content.height = this.itemHeight * rankDatas.length;\r\n        this.bar.y = -this.itemHeight * (rankDatas.length - 1);\r\n        this.barBg.height = this.itemHeight * (rankDatas.length - 1);\r\n        this.bar.height = rankData.id * this.itemHeight + this.itemHeight * rate;\r\n        this.itemScrollView.scrollToOffset(cc.v2(0, this.itemHeight * (rankDatas.length - 1.5) - this.bar.height))\r\n\r\n        this.refresh();\r\n        this.onScrollView();\r\n    },\r\n\r\n    refresh: function () {\r\n        for (let itemComp of this._itemCells) {\r\n            var data = itemComp.data;\r\n            var item = itemComp.item;\r\n            var isGet = false;\r\n            var canUnlock = PlayerData.instance.rankData.id >= data.id;\r\n            if (item) {\r\n                switch (item.type) {\r\n                    case ItemType.HERO_SKIN:\r\n                        isGet = PlayerData.instance.isOwnHeroSkin(item.id);\r\n                        break;\r\n                    case ItemType.KNIFE_SKIN:\r\n                        isGet = PlayerData.instance.isOwnKnifeSkin(item.id);\r\n                        break;\r\n                    case ItemType.MONEY:\r\n                        isGet = Tools.arrContains(PlayerData.instance.completeRankRewardIds, data.id);\r\n                        break;\r\n                }\r\n            }\r\n            itemComp.refresh(isGet, canUnlock);\r\n        }\r\n    },\r\n\r\n    onItemClick: function (event, customEventData) {\r\n        var itemComp = customEventData;\r\n        var data = itemComp.data;\r\n        var item = itemComp.item;\r\n        if (Tools.arrContains(PlayerData.instance.completeRankRewardIds, data.id)) return;\r\n        switch (item.type) {\r\n            case ItemType.HERO_SKIN:\r\n            case ItemType.KNIFE_SKIN:\r\n                this.unLockBtnClick(itemComp);\r\n                break;\r\n            case ItemType.MONEY:\r\n                PlayerData.instance.updateGold(item.num);\r\n                PlayerData.instance.showGold -= item.num;\r\n                PlayerData.instance.addCompleteRankReward(data.id);\r\n                var param = {\r\n                    count: item.num,\r\n                    isMore: true,\r\n                    isLucky: false,\r\n                }\r\n                this.world.uiMgr.showGetMoneyEffect(param);\r\n                this.world.uiMgr.refreshRedDot();\r\n                itemComp.refresh(true, true);\r\n                break;\r\n        }\r\n\r\n    },\r\n\r\n\r\n    unLockBtnClick: function (itemComp) {\r\n        var self = this;\r\n        // 关闭广告时回调\r\n        var closeFunc = (success) => {\r\n            self.unLockCallback(success, itemComp);\r\n        }\r\n        // 打开广告失败时回调,失败回调\r\n        var errFunc = () => {\r\n            self.showShare(itemComp);\r\n            // self.world.uiMgr.showTips('暂未获取到广告信息，请稍后再试')\r\n        }\r\n        AdvertMgr.instance.showAdver(AdverType.UnlockSkin, closeFunc, errFunc);\r\n    },\r\n\r\n    showShare: function (itemComp) {\r\n        const self = this;\r\n        ShareMgr.share(ShareType.UnlockSkin, (success) => {\r\n            self.unLockCallback(success, itemComp);\r\n        });\r\n    },\r\n\r\n    unLockCallback: function (success, itemComp) {\r\n        const self = this;\r\n        if (itemComp && success) {\r\n            var item = itemComp.item;\r\n            PlayerData.instance.addCompleteRankReward(itemComp.data.id);\r\n            var skinId = itemComp.item.id;\r\n            switch (item.type) {\r\n                case ItemType.HERO_SKIN:\r\n                    //加入背包\r\n                    PlayerData.instance.addHeroSkin(skinId);\r\n                    //装备上\r\n                    var data = ConfigData.instance.getHeroSkinById(skinId);\r\n                    self.world.onEquipHeroSkin(data, true);\r\n                    //展示出来\r\n                    self.world.uiMgr.showReward(data);\r\n                    break;\r\n                case ItemType.KNIFE_SKIN:\r\n                    //加入背包\r\n                    PlayerData.instance.addKnifeSkin(skinId);\r\n                    //装备上\r\n                    var data = ConfigData.instance.getKnifeSkinById(skinId);\r\n                    self.world.onEquipKnifeSkin(data, true);\r\n                    //展示出来\r\n                    self.world.uiMgr.showReward(data);\r\n                    break;\r\n            }\r\n            self.world.uiMgr.refreshRedDot();\r\n            itemComp.refresh(true, true);\r\n        }\r\n    },\r\n\r\n    onScrollView: function () {\r\n        // return;\r\n        //当前滑动所在位置\r\n        var curScrollHeight = this.itemScrollView.getScrollOffset().y;\r\n\r\n        var count = 0;\r\n        var index = 25 - Math.floor((curScrollHeight - 100) / this.itemHeight);\r\n        for (let i = index; i >= 0; i--) {\r\n            var item = this._itemCells[i];\r\n            if (item.unLockNode.active) {\r\n                count++;\r\n            }\r\n        }\r\n\r\n        if (count) {\r\n            this.countNode.active = true;\r\n            if (count !== this.countLabel.string) this.countLabel.string = count;\r\n        } else {\r\n            this.countNode.active = false;\r\n        }\r\n\r\n        for (let i = 0; i < this._itemCells.length; i++) {\r\n            if (i < (index + 4) && i > (index - 2)) {\r\n                if (!this._itemNodes[i].active) this._itemNodes[i].active = true;\r\n            } else {\r\n                if (this._itemNodes[i].active) this._itemNodes[i].active = false;\r\n            }\r\n        }\r\n        // if (curScrollHeight < Math.floor((this._itemCells.length - 1) / 3) * 150 - 300) {\r\n        //     if (!this.downNode.active) this.downNode.active = true;\r\n        // } else {\r\n        //     if (this.downNode.active) this.downNode.active = false;\r\n        // };\r\n\r\n    },\r\n\r\n\r\n    onCloseBtnClick: function () {\r\n        this.node.active = false;\r\n        AdvertMgr.instance.destoryBanner();\r\n    },\r\n});"]}