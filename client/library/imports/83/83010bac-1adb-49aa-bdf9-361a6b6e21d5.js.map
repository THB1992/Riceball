{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\singleton/assets\\scripts\\battle\\component\\singleton\\CameraZoomCtrl.js"],"names":["Tools","require","CameraZoomCtrl","cc","Class","extends","Component","properties","_maxSpeed","Number","MAX_VALUE","_smoothTime","_curCameraRate","_targetCameraZoom","_currentVelocityRate","camera","Camera","_curSpeed","_needChange","onLoad","cleanUp","setCameraZoomImmediately","setCameraZoom","zoom","resetCameraRate","zoomRatio","update","dt","dataRate","smoothDamp","isFloatEqual"],"mappings":";;;;;;AAAA;;;;;AAKA,IAAMA,QAAQC,QAAQ,OAAR,CAAd;;AAEA;;;AAGA,IAAIC,iBAAiBC,GAAGC,KAAH,CAAS;AAC1BC,aAASF,GAAGG,SADc;;AAG1BC,gBAAY;AACR;AACAC,mBAAWC,OAAOC,SAFV;AAGR;AACAC,qBAAa,IAJL;AAKRC,wBAAgB,CALR;AAMRC,2BAAmB,CAAC,CANZ;AAORC,8BAAsB,CAPd;AAQRC,gBAAQZ,GAAGa,MARH;AASRC,mBAAW,GATH;AAURC,qBAAa;AAVL,KAHc;;AAgB1BC,YAAQ,kBAAY,CACnB,CAjByB;;AAmB1BC,aAAS,mBAAY;AACjB,aAAKC,wBAAL,CAA8B,CAA9B;AACH,KArByB;;AAuB1BC,mBAAe,uBAAUC,IAAV,EAAgB;AAC3B,aAAKV,iBAAL,GAAyBU,IAAzB;AACA,aAAKL,WAAL,GAAmB,IAAnB;AACH,KA1ByB;;AA4B1B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAM,qBAAiB,2BAAY;AACzB,aAAKF,aAAL,CAAmB,CAAnB;AACH,KAtCyB;;AAwC1BD,8BAA0B,kCAAUE,IAAV,EAAgB;AACtC,aAAKV,iBAAL,GAAyBU,IAAzB;AACA,aAAKL,WAAL,GAAmB,KAAnB;AACA,aAAKN,cAAL,GAAsBW,IAAtB;AACA,aAAKR,MAAL,CAAYU,SAAZ,GAAwBF,IAAxB;AACH,KA7CyB;;AA+C1BG,YAAQ,gBAAUC,EAAV,EAAc;AAClB,YAAI,KAAKT,WAAT,EAAsB;AAClB,gBAAMU,WAAW5B,MAAM6B,UAAN,CAAiB,KAAKjB,cAAtB,EAAsC,KAAKC,iBAA3C,EAA8D,KAAKC,oBAAnE,EAAyF,KAAKH,WAA9F,EAA2G,KAAKH,SAAhH,EAA2H,KAAKS,SAAL,GAAeU,EAA1I,CAAjB;AACA,iBAAKb,oBAAL,GAA4Bc,SAAS,CAAT,CAA5B;AACA,iBAAKhB,cAAL,GAAsBgB,SAAS,CAAT,CAAtB;AACA,iBAAKb,MAAL,CAAYU,SAAZ,GAAwB,KAAKb,cAA7B;;AAEA;;AAEA,gBAAGZ,MAAM8B,YAAN,CAAmB,KAAKjB,iBAAxB,EAA2C,KAAKD,cAAhD,CAAH,EAAoE;AAChE,qBAAKM,WAAL,GAAmB,KAAnB;AACH;AACJ;AACJ;AA5DyB,CAAT,CAArB","file":"CameraZoomCtrl.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\singleton","sourcesContent":["/**\n * @fileoverview CameraZoomCtrl\n * @author meifan@gameley.cn (梅凡)\n */\n\nconst Tools = require(\"Tools\");\n\n/**\n * 相机焦距调节器\n */\nvar CameraZoomCtrl = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        /** 最大移动速度 */\n        _maxSpeed: Number.MAX_VALUE,\n        /** 缓动时间 */\n        _smoothTime: 0.15,\n        _curCameraRate: 1,\n        _targetCameraZoom: -1,\n        _currentVelocityRate: 0,\n        camera: cc.Camera,\n        _curSpeed: 1.4,\n        _needChange: false,\n    },\n\n    onLoad: function () {\n    },\n\n    cleanUp: function () {\n        this.setCameraZoomImmediately(1);\n    },\n\n    setCameraZoom: function (zoom) {\n        this._targetCameraZoom = zoom;\n        this._needChange = true;\n    },\n\n    // setZoomSpeed: function (isFast) {\n    //     if(isFast) {\n    //         this._curSpeed = 1000;\n    //     } else {\n    //         this._curSpeed = 1.4;\n    //     }\n    // },\n\n    resetCameraRate: function () {\n        this.setCameraZoom(1);\n    },\n\n    setCameraZoomImmediately: function (zoom) {\n        this._targetCameraZoom = zoom;\n        this._needChange = false;\n        this._curCameraRate = zoom;\n        this.camera.zoomRatio = zoom;\n    },\n\n    update: function (dt) {\n        if (this._needChange) {\n            const dataRate = Tools.smoothDamp(this._curCameraRate, this._targetCameraZoom, this._currentVelocityRate, this._smoothTime, this._maxSpeed, this._curSpeed*dt);\n            this._currentVelocityRate = dataRate[1];\n            this._curCameraRate = dataRate[0];\n            this.camera.zoomRatio = this._curCameraRate;\n\n            // console.log('targetZoom: ' + this._targetCameraZoom + ', curZoom: ' + this._curCameraRate);\n\n            if(Tools.isFloatEqual(this._targetCameraZoom, this._curCameraRate)) {\n                this._needChange = false;\n            }\n        }\n    },\n});"]}