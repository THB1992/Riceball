{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\player\\AI/assets\\scripts\\battle\\component\\player\\AI\\ConditionFindNoDangerPos.js"],"names":["ConditionBaseComponent","require","GameData","Tools","MapType","ConditionFindNoDangerPos","cc","Class","extends","properties","init","speed","setMapSize","instance","mapWidth","mapHeight","_speed","node","on","initWalls","type","wallType","_Width","_height","detail","width","height","getReal","_min","v2","_max","value","ret","Circle","doResultWithParam","params","_curPos","position","result","clone","subSelf","normalizeSelf","block","sub","compareVec2","Vec2","ZERO","mulSelf","addSelf","clampf"],"mappings":"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","file":"ConditionFindNoDangerPos.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\player\\AI","sourcesContent":["/**\n * @fileoverview 离其他ai太近条件\n * @author meifan@gameley.cn (梅凡)\n */\n\nconst ConditionBaseComponent = require('ConditionBaseComponent');\nconst GameData = require('GameData');\nconst Tools = require('Tools');\nconst MapType = require('Types').MapType;\n\n// result从PlayerDistanceSystem确定，是另外多个block的Entity的数组\nconst ConditionFindNoDangerPos = cc.Class({\n    extends: ConditionBaseComponent,\n\n    properties: {},\n\n    init: function (speed) {\n        this.setMapSize([GameData.instance.mapWidth, GameData.instance.mapHeight]);\n        this._speed = speed;\n\n        this.node.on('setMapSize', this.setMapSize, this);\n        this.node.on('initWalls', this.initWalls, this);\n    },\n\n    initWalls: function (type) {\n        this.wallType = type;\n        this.setMapSize([this._Width, this._height]);\n    },\n\n    setMapSize: function (detail) {\n        const width = detail[0];\n        const height = detail[1];\n\n        this._Width = this.getReal(width);\n        this._height = this.getReal(height);\n\n        this._min = cc.v2(-this._Width / 2, -this._height / 2);\n        this._max = cc.v2(this._Width / 2, this._height / 2);\n    },\n\n    getReal: function (value) {\n        var ret = value * 0.9;\n        \n        if(this.wallType) {\n            if(this.wallType === MapType.Circle) {\n                ret = ret / 1.5;\n            }\n        }\n\n        return ret;\n    },\n\n\n    /** overwrite */\n    doResultWithParam: function (params) {\n\n        var v2 = null;\n        this._curPos = this.node.position;\n        \n        this.result = params[1].clone().subSelf(this._curPos).normalizeSelf();\n        // this.lerp = Tools.getRandomFloat(0.3,0.4);\n        for (var block of params[0]) {\n            // var parent = block.parent;\n            // v2 = parent ? parent.position.add(block.position) : block.position;\n            v2 = block.position.sub(this.node.position).normalizeSelf();\n            // v2 = cc.v2(v2.y, -v2.x);\n            this.result = this.result.subSelf(v2);\n            // console.log(' this.result.mag: ' + this.result.magSqr());\n            if(Tools.compareVec2(this.result, cc.Vec2.ZERO, 0.1)) {\n                this.result = false;\n                break;\n            }\n            this.result = this.result.normalizeSelf();//.mulSelf(this.lerp) : v2;\n        }\n\n        if(this.result) {\n            this.result = this.result.mulSelf(this._speed).addSelf(this.node.position).clampf(this._min, this._max);\n        }\n    },\n\n    // updateGameLogic: function (dt) {}\n\n    // update: {}\n});"]}