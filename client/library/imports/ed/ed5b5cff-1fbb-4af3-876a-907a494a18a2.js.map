{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui/assets\\scripts\\battle\\ui\\PanelWorldReward.js"],"names":["ConfigData","require","BagItem","ItemType","PlayerData","GameData","JDCARD","cc","Class","extends","Component","properties","rankLabel","Label","tipsText","RichText","diamondLabel","goldLabel","receiveBtn","Node","detailBtn","realNode","unRealNode","heroNode","cardNode","cardLabel","heroLabel","init","rankData","callback","world","rank","round","joinTime","data","instance","getWorldRewardByRank","isShowLog","console","log","hasReceiveWorldRound","close","string","active","items","createItemsWithString","reward","i","length","item","type","MONEY","goldNum","num","ZONG_ZI","diamondNum","CARD","cards","children","j","tips","HERO_SKIN","showPanelRewardDetail","uiMgr","receive","updateGold","showGold","param","count","isMore","isLucky","showGetMoneyEffect","updateZongZi","showTips","Tools","getStringByFormat","getUITipStr","isOwnHeroSkin","id","addHeroSkin","isConvert","onEquipHeroSkin","itemData","KNIFE_SKIN","isOwnKnifeSkin","addKnifeSkin","onEquipKnifeSkin","updateReceiveRound","updateDayRefreshWorldReward","node"],"mappings":"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","file":"PanelWorldReward.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui","sourcesContent":["const ConfigData = require('ConfigData');\r\nconst BagItem = require('BagItem');\r\nconst ItemType = require('Types').ItemType;\r\nconst PlayerData = require('PlayerData');\r\nconst GameData = require('GameData');\r\nconst JDCARD = [50, 100, 200, 500];\r\ncc.Class({\r\n\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        rankLabel: cc.Label,\r\n        tipsText: cc.RichText,\r\n        diamondLabel: cc.Label,\r\n        goldLabel: cc.Label,\r\n\r\n        receiveBtn: cc.Node,\r\n        detailBtn: cc.Node,\r\n\r\n        realNode: cc.Node,\r\n        unRealNode: cc.Node,\r\n        heroNode: cc.Node,\r\n        cardNode: cc.Node,\r\n        cardLabel: cc.Label,\r\n        heroLabel: cc.Label,\r\n    },\r\n\r\n    //第几轮和第几名\r\n    init(rankData, callback, world) {\r\n        this.callback = callback;\r\n        this.world = world;\r\n        this.rankData = rankData;\r\n        var rank = rankData.rank;\r\n        var round = rankData.round;\r\n        var joinTime = rankData.joinTime;\r\n        var data = ConfigData.instance.getWorldRewardByRank(rank);\r\n        if (GameData.instance.isShowLog()) {\r\n            console.log('--------------------------刷新世界排名奖励：', joinTime, '轮次:', round, '名次:', rank)\r\n        }\r\n\r\n        if (rank === -1 || PlayerData.instance.hasReceiveWorldRound(joinTime) || !data) {\r\n            this.close(false);\r\n        } else {\r\n            this.rankLabel.string = '世界第' + rank + '名';\r\n            this.tipsText.string = '恭喜你取得世界PK（第' + round + '轮）</color=##EEE50E>第' + rank + '名';\r\n\r\n            this.realNode.active = false;\r\n            this.unRealNode.active = false;\r\n            this.heroNode.active = false;\r\n            this.receiveBtn.active = true;\r\n            this.detailBtn.active = false;\r\n\r\n            this.items = BagItem.createItemsWithString(data.reward);\r\n            for (let i = 0; i < this.items.length; i++) {\r\n                var item = this.items[i];\r\n                switch (item.type) {\r\n                    case ItemType.MONEY:\r\n                        this.unRealNode.active = true;\r\n                        this.goldNum = item.num;\r\n                        this.goldLabel.string = 'x' + this.goldNum;\r\n                        break;\r\n                    case ItemType.ZONG_ZI:\r\n                        this.unRealNode.active = true;\r\n                        this.diamondNum = item.num;\r\n                        this.diamondLabel.string = '钻石x' + this.diamondNum;\r\n                        break;\r\n                    case ItemType.CARD:\r\n                        this.realNode.active = true;\r\n                        this.detailBtn.active = true;\r\n                        this.receiveBtn.active = false;\r\n\r\n                        var cards = this.cardNode.children;\r\n                        for (let j = 0; j < cards.length; j++) {\r\n                            cards[j].active = item.num === JDCARD[j];\r\n                        }\r\n                        this.cardLabel.string = data.tips;\r\n                        break;\r\n                    case ItemType.HERO_SKIN:\r\n                        this.heroNode.active = true;\r\n                        this.heroLabel.string = data.tips;\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    showPanelRewardDetail() {\r\n        this.world.uiMgr.showPanelRewardDetail();\r\n    },\r\n\r\n    close(receive = true) {\r\n        if (receive) {\r\n            for (let i = 0; i < this.items.length; i++) {\r\n                var item = this.items[i];\r\n                switch (item.type) {\r\n                    case ItemType.MONEY:\r\n                        PlayerData.instance.updateGold(item.num);\r\n                        PlayerData.instance.showGold -= item.num;\r\n                        var param = {\r\n                            count: item.num,\r\n                            isMore: true,\r\n                            isLucky: false,\r\n                        }\r\n                        this.world.uiMgr.showGetMoneyEffect(param);\r\n                        break;\r\n                    case ItemType.ZONG_ZI:\r\n                        PlayerData.instance.updateZongZi(item.num);\r\n                        this.world.uiMgr.showTips(Tools.getStringByFormat(ConfigData.instance.getUITipStr(15), item.num))\r\n                        break;\r\n                    case ItemType.HERO_SKIN:\r\n                        if (!PlayerData.instance.isOwnHeroSkin(item.id)) {\r\n                            PlayerData.instance.addHeroSkin(item.id);\r\n                        } else {\r\n                            this.isConvert = true;\r\n                        }\r\n                        this.world.onEquipHeroSkin(item.itemData, true);\r\n                        break;\r\n                    case ItemType.KNIFE_SKIN:\r\n                        if (!PlayerData.instance.isOwnKnifeSkin(item.id)) {\r\n                            PlayerData.instance.addKnifeSkin(item.id);\r\n                        } else {\r\n                            this.isConvert = true;\r\n                        }\r\n                        this.world.onEquipKnifeSkin(item.itemData, true);\r\n                        break;\r\n                }\r\n            }\r\n            if (this.isConvert) {\r\n                this.world.uiMgr.showTips('已拥有哪吒套装，自动转化为150钻石')\r\n                PlayerData.instance.updateZongZi(150);\r\n            }\r\n            PlayerData.instance.updateReceiveRound(this.rankData.joinTime, false);\r\n\r\n        }\r\n\r\n        PlayerData.instance.updateDayRefreshWorldReward();\r\n        this.node.active = false;\r\n        if (this.callback) this.callback();\r\n    },\r\n    // update (dt) {},\r\n});"]}