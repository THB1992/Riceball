{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui/assets\\scripts\\battle\\ui\\PanelTryOut.js"],"names":["Tools","require","ConfigData","PlayerData","AdvertMgr","AdverType","ShareMgr","ShareType","StageType","cc","Class","extends","Component","properties","tryHeroSkinIcon","Node","tryKnifeSkinIcon","nameLabel","Label","goldNode","diamondNode","priceLabel","RichText","priceDiamondLabel","knifeCountNode","propertyNode","knifePropertyIcon","heroPropertyIcon","propertyLabel","adverIcon","shareIcon","noThanksLabel","init","data","callback","closeCallback","isHeroSkin","arrContains","instance","heroSkinDatas","active","string","name","price","priceType","str","fontSize","length","propertyTips","x","stage","getCurStageByPrizeCount","Free","Share","Adver","func","hasAdver","openAdver","TryOutSkin","loadAdver","closeBtnClick","isAdver","node","adverBtnClick","self","closeFunc","success","errFunc","showShare","showAdver","share"],"mappings":"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","file":"PanelTryOut.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui","sourcesContent":["const Tools = require('Tools');\r\nconst ConfigData = require('ConfigData');\r\nconst PlayerData = require('PlayerData');\r\nconst AdvertMgr = require('AdvertMgr');\r\nconst AdverType = require('Types').AdverType;\r\nconst ShareMgr = require('ShareMgr');\r\nconst ShareType = require('Types').ShareType;\r\nconst StageType = require('Types').StageType;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // knifeCountLabel: cc.Label,\r\n        tryHeroSkinIcon: cc.Node,\r\n        tryKnifeSkinIcon: cc.Node,\r\n\r\n        nameLabel: cc.Label,\r\n        goldNode: cc.Node,\r\n        diamondNode: cc.Node,\r\n        priceLabel: cc.RichText,\r\n        priceDiamondLabel: cc.RichText,\r\n\r\n        knifeCountNode: cc.Node,\r\n        propertyNode: cc.Node,\r\n        knifePropertyIcon: cc.Node,\r\n        heroPropertyIcon: cc.Node,\r\n        propertyLabel: cc.RichText,\r\n\r\n        adverIcon: cc.Node,\r\n        shareIcon: cc.Node,\r\n        //language\r\n        noThanksLabel: cc.Label,\r\n    },\r\n\r\n    init: function (data, callback, closeCallback) {\r\n        if (callback) callback();\r\n        var isHeroSkin = Tools.arrContains(ConfigData.instance.heroSkinDatas, data);\r\n        this.tryHeroSkinIcon.active = isHeroSkin;\r\n        this.tryKnifeSkinIcon.active = !isHeroSkin;\r\n        // if (isHeroSkin) {\r\n        //     this.knifeCount.string = PlayerData.instance.knifeSkin.initKnifeCount + PlayerData.instance.extraKnifeCount;\r\n        // } else {\r\n        //     this.knifeCount.string = data.initKnifeCount + PlayerData.instance.extraKnifeCount;\r\n        // }\r\n\r\n        // this.knifeCount.string = 6;\r\n        this.closeCallback = closeCallback;\r\n        this.nameLabel.string = data.name;\r\n        if (data.price) {\r\n            if (data.priceType === 0) {\r\n                this.priceLabel.string = '<i>' + data.price + '</i> '\r\n            } else {\r\n                this.priceDiamondLabel.string = '<i>' + data.price + '</i> '\r\n            }\r\n        }\r\n        this.goldNode.active = data.priceType === 0;\r\n        this.diamondNode.active = data.priceType === 1;\r\n\r\n\r\n        var str = data.price + '';\r\n        this.priceLabel.fontSize = 42 - (str.length - 5) * 6;\r\n        if (this.priceLabel.fontSize < 20) this.priceLabel.fontSize = 20;\r\n        this.propertyNode.active = data.propertyTips ? true : false;\r\n        this.knifePropertyIcon.active = isHeroSkin ? false : true;\r\n        this.heroPropertyIcon.active = isHeroSkin ? true : false;\r\n        this.propertyLabel.string = data.propertyTips ? '<i>' + data.propertyTips + '</i> ' : '';\r\n\r\n        this.knifeCountNode.x = this.propertyNode.active ? 0 : 78;\r\n\r\n        // AdvertMgr.instance.showBanner();\r\n\r\n        // var stage = ConfigData.instance.getCurStage(PlayerData.instance.playCount, ConfigData.instance.clientData.adverReviveLimit);\r\n        var stage = ConfigData.instance.getCurStageByPrizeCount(PlayerData.instance);\r\n        switch (stage) {\r\n            case StageType.Free:\r\n                break;\r\n            case StageType.Share:\r\n                this.adverIcon.active = false;\r\n                this.shareIcon.active = true;\r\n                break;\r\n            case StageType.Adver:\r\n                var func = (hasAdver) => {\r\n                    this.adverIcon.active = hasAdver;\r\n                    this.shareIcon.active = !hasAdver;\r\n\r\n                    if (hasAdver) {\r\n                        AdvertMgr.instance.openAdver(AdverType.TryOutSkin);\r\n                    }\r\n                }\r\n\r\n                AdvertMgr.instance.loadAdver(AdverType.TryOutSkin, func);\r\n                break;\r\n        }\r\n\r\n\r\n        this.noThanksLabel.string = \"No,thanks\";\r\n    },\r\n\r\n    closeBtnClick: function () {\r\n        if (this.isAdver) return;\r\n        if (this.closeCallback) this.closeCallback(false);\r\n        this.node.active = false;\r\n        // AdvertMgr.instance.destoryBanner();\r\n    },\r\n\r\n    adverBtnClick: function () {\r\n        this.isAdver = true;\r\n        var self = this;\r\n        // 关闭广告时回调\r\n        var closeFunc = function (success) {\r\n            if (success) {\r\n                if (self.closeCallback) self.closeCallback(true);\r\n                // AdvertMgr.instance.destoryBanner();\r\n                self.node.active = false;\r\n            }\r\n            self.isAdver = false;\r\n        }\r\n        // 打开广告失败时回调,失败回调\r\n        var errFunc = function () {\r\n            self.showShare();\r\n            self.isAdver = false;\r\n        }\r\n\r\n        if (this.shareIcon.active) {\r\n            self.showShare();\r\n            self.isAdver = false;\r\n        } else {\r\n            AdvertMgr.instance.showAdver(AdverType.TryOutSkin, closeFunc, errFunc);\r\n        }\r\n\r\n    },\r\n\r\n    showShare: function () {\r\n        var self = this;\r\n        ShareMgr.share(ShareType.TryOutSkin, (success) => {\r\n            if (success) {\r\n                if (self.closeCallback) self.closeCallback(true);\r\n                // AdvertMgr.instance.destoryBanner();\r\n                self.node.active = false;\r\n            }\r\n        });\r\n    },\r\n});"]}