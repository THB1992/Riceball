{"version":3,"sources":["PowerArrow.js"],"names":["cc","Class","extends","Component","properties","weakNode","Node","weakArrow","strongNode","strongArrow","refresh","player","localPlayer","dir","node","position","sub","normalize","radius","logicPlayer","finalPos","add","mul","roll","angle","v2","Math","PI","x","isDefence","active","attackPower","defencePower","_dangerousEffect","play","isPlay","setTimeout","rotation","close"],"mappings":"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","file":"PowerArrow.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\effect","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        weakNode: cc.Node,\r\n        weakArrow: cc.Node,\r\n        strongNode: cc.Node,\r\n        strongArrow: cc.Node,\r\n    },\r\n\r\n    refresh(player, localPlayer) {\r\n\r\n        var dir = localPlayer.node.position.sub(player.node.position).normalize();\r\n        var radius = player.logicPlayer.radius;\r\n        var finalPos = player.node.position.add(dir.mul(radius));\r\n\r\n        var roll = dir.angle(cc.v2(0, 1)) * 180 / Math.PI;\r\n        if (dir.x < 0) roll = -roll;\r\n\r\n        if (localPlayer.isDefence) {\r\n            if (this.strongNode.active) this.strongNode.active = false;\r\n            if (this.weakNode.active) this.weakNode.active = false;\r\n            if (player.attackPower > localPlayer.defencePower) {\r\n                if (!localPlayer._dangerousEffect.node.active) {\r\n                    localPlayer._dangerousEffect.node.active = true;\r\n                    // _attackStartEffect\r\n                    // _dangerousEffect\r\n                    localPlayer._dangerousEffect.play();\r\n                    this.isPlay = true;\r\n                    setTimeout(() => {\r\n                        localPlayer._dangerousEffect.node.active = false;\r\n                    }, 1500);\r\n                }\r\n            }\r\n        } else if (player.isDefence) {\r\n            if (localPlayer.attackPower <= player.defencePower) {\r\n                if (!this.strongNode.active) this.strongNode.active = true;\r\n                if (this.weakNode.active) this.weakNode.active = false;\r\n\r\n                this.strongNode.position = finalPos;\r\n                this.strongArrow.rotation = roll - 180;\r\n            } else {\r\n                if (this.strongNode.active) this.strongNode.active = false;\r\n                if (!this.weakNode.active) this.weakNode.active = true\r\n\r\n                this.weakNode.position = finalPos;\r\n                this.weakArrow.rotation = roll - 180;\r\n            }\r\n        } else {\r\n            if (this.strongNode.active) this.strongNode.active = false;\r\n            if (this.weakNode.active) this.weakNode.active = false;\r\n        }\r\n\r\n    },\r\n    close() {\r\n        if (this.strongNode.active) this.strongNode.active = false;\r\n        if (this.weakNode.active) this.weakNode.active = false;\r\n    }\r\n    // update (dt) {},\r\n});"]}