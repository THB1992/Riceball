{"version":3,"sources":["HeroMove.js"],"names":["GameData","require","cc","Class","extends","Component","properties","moveSpeed","moveSpeedRate","skinSpeedAddition","growSpeedAddition","attackBoxSpeedRate","finalAttackBoxSpeedRate","attackBoxTime","onLoad","node","on","onMoveByKeyboard","onStopMovingByKeyboard","changeSpeedRate","onAttackBox","onStopMove","init","game","state","stopMove","console","log","isSlow","changeFinalAttackBoxSpeedRate","rate","speedPer","detail","changeSkinSpeedAddition","changeGrowSpeedAddition","onMoveBy","dPos","_moveByPos","onNodeMoveBy","dt","dir","normalize","x","instance","speedRate","y","updateGameLogic","getCurSpeed"],"mappings":"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","file":"HeroMove.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\move","sourcesContent":["/**\n * @fileoverview 键盘移动监听器\n * @author meifan@gameley.cn (梅凡)\n */\n\nconst GameData = require('GameData');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        moveSpeed: 504,\n        moveSpeedRate: 1.0,\n        skinSpeedAddition: 0,\n        growSpeedAddition: 0,\n        attackBoxSpeedRate: 1,\n        finalAttackBoxSpeedRate: 1,\n        attackBoxTime: 0,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    /**\n     * onLoad\n     */\n    onLoad: function () {\n\n        this.node.on('onMoveBy', this.onMoveByKeyboard, this);\n        this.node.on('onStopMoving', this.onStopMovingByKeyboard, this);\n        this.node.on('changeSpeedRate', this.changeSpeedRate, this);\n        this.node.on('onAttackBox', this.onAttackBox, this);\n        this.node.on('onStopMove', this.onStopMove, this);\n    },\n\n    /**\n     * 初始化\n     * @param {entity} game 游戏世界\n     */\n    init: function (game) {\n\n    },\n\n\n    onStopMove: function (state) {\n        this.stopMove = state;\n    },\n\n    onAttackBox: function () {\n        console.log('撞到盒子');\n        this.isSlow = true;\n        this.attackBoxTime = 0;\n        this.changeFinalAttackBoxSpeedRate(0.4)\n    },\n\n    changeFinalAttackBoxSpeedRate(rate) {\n        this.finalAttackBoxSpeedRate = rate;\n        this.speedPer = rate - this.attackBoxSpeedRate;\n    },\n\n\n    changeSpeedRate: function (detail) {\n\n        this.moveSpeedRate = detail;\n        // this.moveSpeed *= detail;\n    },\n\n    changeSkinSpeedAddition: function (detail) {\n        this.skinSpeedAddition = detail;\n    },\n\n    changeGrowSpeedAddition: function (detail) {\n        this.growSpeedAddition = detail;\n    },\n    /** \n     * 监听键盘移动方法\n     * @param {cc.p} detail.dPos\n     */\n    onMoveByKeyboard: function (detail) {\n        this.onMoveBy(detail.dPos);\n    },\n\n    /** \n     * 移动 调用世界实体的移动接口\n     * @param {cc.p} dPos\n     */\n    onMoveBy: function (dPos) {\n        this._moveByPos = dPos;\n    },\n\n    /**\n     * 监听键盘停止移动方法\n     */\n    onStopMovingByKeyboard: function () {\n        this._moveByPos = null;\n    },\n\n    onNodeMoveBy(dt) {\n        if (this._moveByPos) {\n            // var curPos = this.node.position;\n            // curPos = curPos.add(this._moveByPos);\n            // this.moveToPos = curPos;\n            let dir = this._moveByPos.normalize();\n            this.node.x += this.moveSpeed * this.attackBoxSpeedRate * (this.moveSpeedRate + this.skinSpeedAddition + this.growSpeedAddition) * GameData.instance.speedRate * dir.x * dt;\n            this.node.y += this.moveSpeed * this.attackBoxSpeedRate * (this.moveSpeedRate + this.skinSpeedAddition + this.growSpeedAddition) * GameData.instance.speedRate * dir.y * dt;\n        }\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    /**\n     * 目前在entity身上直接调用，之后会移到entityGame的MoveSystem里(暂时不考虑)\n     */\n    updateGameLogic(dt) {\n        // this.attackBoxTime += dt;\n\n        // if (this.attackBoxTime > 0.1 && this.isSlow) {\n        //     this.isSlow = false;\n        //     this.changeFinalAttackBoxSpeedRate(2)\n        // } else if (this.attackBoxTime > 1.1 && !this.isSlow) {\n        //     this.changeFinalAttackBoxSpeedRate(1)\n        // }\n\n        // if (this.finalAttackBoxSpeedRate !== this.attackBoxSpeedRate) {\n        //     this.attackBoxSpeedRate += this.speedPer * dt * 100;\n        //     if (this.speedPer > 0) {\n        //         if (this.attackBoxSpeedRate > this.finalAttackBoxSpeedRate) {\n        //             this.attackBoxSpeedRate = this.finalAttackBoxSpeedRate;\n        //         }\n        //     } else {\n        //         if (this.attackBoxSpeedRate < this.finalAttackBoxSpeedRate) {\n        //             this.attackBoxSpeedRate = this.finalAttackBoxSpeedRate;\n        //         }\n        //     }\n        // }\n        if (this.stopMove) return;\n        this.onNodeMoveBy(dt);\n    },\n\n    getCurSpeed: function () {\n        return this.moveSpeed * (this.moveSpeedRate + this.skinSpeedAddition) * GameData.instance.speedRate;\n    }\n});"]}