{"version":3,"sources":["HeroMoveFixByCircle.js"],"names":["cc","Class","extends","Component","properties","lastPos","v2","init","_collider","followPlayer","attackRadius","onLoad","node","on","radiusChange","detail","refresh","width","height","updateGameLogic","x","position","y","heroRadius","radius","parent","scale","dir","normalize","distance","mag","add","mul","heroAttackRadius","isColl","emit"],"mappings":";;;;;;AAAA;;;;AAIAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,iBAASL,GAAGM,EAAH,CAAM,CAAN,EAAS,CAAT;AADD,KAHP;;AAQLC,UAAM,cAAUC,SAAV,EAAqBC,YAArB,EAAmC;AACrC,aAAKA,YAAL,GAAoBA,YAApB;AACA,aAAKD,SAAL,GAAiBA,SAAjB;AACA,aAAKE,YAAL,GAAoB,CAApB;AACH,KAZI;;AAcLC,YAAQ,kBAAY;AAChB,aAAKC,IAAL,CAAUC,EAAV,CAAa,cAAb,EAA6B,KAAKC,YAAlC,EAAgD,IAAhD;AACH,KAhBI;;AAkBLA,kBAAc,sBAAUC,MAAV,EAAkB;AAC5B,aAAKL,YAAL,GAAoBK,MAApB;AACH,KApBI;;AAsBLC,aAAS,iBAAUC,KAAV,EAAiBC,MAAjB,EAAyB;AAC9B,aAAKD,KAAL,GAAaA,QAAQ,CAArB;AACA,aAAKC,MAAL,GAAcA,SAAS,CAAvB;AACH,KAzBI;;AA2BLC,qBAAiB,2BAAY;AACzB,YAAI,KAAKd,OAAL,CAAae,CAAb,KAAmB,KAAKR,IAAL,CAAUS,QAAV,CAAmBD,CAAtC,IAA2C,KAAKf,OAAL,CAAaiB,CAAb,KAAmB,KAAKV,IAAL,CAAUS,QAAV,CAAmBC,CAArF,EAAwF;AACpF;AACH;AACD,aAAKjB,OAAL,GAAe,KAAKO,IAAL,CAAUS,QAAzB;;AAEA,YAAIE,aAAa,KAAKf,SAAL,CAAegB,MAAf,GAAwB,KAAKhB,SAAL,CAAeI,IAAf,CAAoBa,MAApB,CAA2BC,KAApE;AACA,YAAIC,MAAM,KAAKf,IAAL,CAAUS,QAAV,CAAmBO,SAAnB,EAAV;AACA,YAAIC,WAAW,KAAKZ,KAAL,GAAaM,UAAb,GAA0B,KAAKX,IAAL,CAAUS,QAAV,CAAmBS,GAAnB,EAAzC;AACA,YAAID,WAAW,CAAf,EAAkB;AACd,iBAAKjB,IAAL,CAAUS,QAAV,GAAqB,KAAKT,IAAL,CAAUS,QAAV,CAAmBU,GAAnB,CAAuBJ,IAAIK,GAAJ,CAAQH,QAAR,CAAvB,CAArB;AACH;AACD,YAAII,mBAAmB,CAAvB;AACA,YAAI,KAAKxB,YAAT,EAAuBwB,mBAAmB,KAAKvB,YAAL,GAAoB,KAAKD,YAAL,CAAkBG,IAAlB,CAAuBc,KAA9D;;AAEvB,YAAIC,MAAM,KAAKf,IAAL,CAAUS,QAAV,CAAmBO,SAAnB,EAAV;AACA,YAAIC,WAAW,KAAKZ,KAAL,GAAagB,gBAAb,GAAgC,KAAKrB,IAAL,CAAUS,QAAV,CAAmBS,GAAnB,EAA/C;AACA,YAAID,WAAW,CAAf,EAAkB;AACd,gBAAI,CAAC,KAAKK,MAAV,EAAkB;AACd,qBAAKA,MAAL,GAAc,IAAd;AACA,qBAAKtB,IAAL,CAAUuB,IAAV,CAAe,kBAAf,EAAmC,IAAnC;AACH;AACJ,SALD,MAKO;AACH,gBAAI,KAAKD,MAAT,EAAiB;AACb,qBAAKA,MAAL,GAAc,KAAd;AACA,qBAAKtB,IAAL,CAAUuB,IAAV,CAAe,kBAAf,EAAmC,KAAnC;AACH;AACJ;AACD;AACA;AACH;AACD;AA1DK,CAAT","file":"HeroMoveFixByCircle.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\move","sourcesContent":["/**\r\n * @fileoverview 玩家在圆形地图的移动校正\r\n * @author zhangzhuang@gameley.cn (张庄)\r\n */\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        lastPos: cc.v2(0, 0),\r\n    },\r\n\r\n\r\n    init: function (_collider, followPlayer) {\r\n        this.followPlayer = followPlayer;\r\n        this._collider = _collider;\r\n        this.attackRadius = 0;\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.node.on('radiusChange', this.radiusChange, this)\r\n    },\r\n\r\n    radiusChange: function (detail) {\r\n        this.attackRadius = detail;\r\n    },\r\n\r\n    refresh: function (width, height) {\r\n        this.width = width / 2;\r\n        this.height = height / 2;\r\n    },\r\n\r\n    updateGameLogic: function () {\r\n        if (this.lastPos.x === this.node.position.x && this.lastPos.y === this.node.position.y) {\r\n            return;\r\n        }\r\n        this.lastPos = this.node.position;\r\n\r\n        var heroRadius = this._collider.radius * this._collider.node.parent.scale;\r\n        var dir = this.node.position.normalize();\r\n        var distance = this.width - heroRadius - this.node.position.mag();\r\n        if (distance < 0) {\r\n            this.node.position = this.node.position.add(dir.mul(distance));\r\n        }\r\n        var heroAttackRadius = 0;\r\n        if (this.followPlayer) heroAttackRadius = this.attackRadius * this.followPlayer.node.scale;\r\n\r\n        var dir = this.node.position.normalize();\r\n        var distance = this.width - heroAttackRadius - this.node.position.mag();\r\n        if (distance < 0) {\r\n            if (!this.isColl) {\r\n                this.isColl = true;\r\n                this.node.emit('isCollCircleWall', true);\r\n            }\r\n        } else {\r\n            if (this.isColl) {\r\n                this.isColl = false;\r\n                this.node.emit('isCollCircleWall', false);\r\n            }\r\n        }\r\n        // var coll=this.mapRadius - heroRadius \r\n        // if(distance)\r\n    },\r\n    // update (dt) {},\r\n});"]}