{"version":3,"sources":["MoveAI.js"],"names":["AIMoveState","require","GameData","Tools","MoveAI","cc","Class","extends","Component","properties","_curMoveState","Normal","_Width","_height","_curPos","_nextPos","_moveDir","_thinkTime","onLoad","instance","mapWidth","mapHeight","init","moveSpeed","moveMag","logicFps","_findNextPos","v2","getRandomInt","_CalMoveDir","node","position","sub","_checkIfFind","dPos","magSqr","update","dt","Moving","emit","Thinking"],"mappings":";;;;;;AAAA;;;;;AAKA,IAAMA,cAAcC,QAAQ,OAAR,EAAiBD,WAArC;AACA,IAAME,WAAWD,QAAQ,UAAR,CAAjB;AACA,IAAME,QAAQF,QAAQ,OAAR,CAAd;;AAEA,IAAMG,SAASC,GAAGC,KAAH,CAAS;AACpBC,aAASF,GAAGG,SADQ;;AAGpBC,gBAAY;AACRC,uBAAeV,YAAYW,MADnB;AAERC,gBAAQ,CAFA;AAGRC,iBAAS,CAHD;AAIRC,iBAAS,IAJD;AAKRC,kBAAU,IALF;AAMRC,kBAAU,IANF;AAORC,oBAAY;AAPJ,KAHQ;;AAapBC,YAAS,kBAAY;AACjB;AACA,aAAKN,MAAL,GAAcV,SAASiB,QAAT,CAAkBC,QAAlB,GAA6B,GAA3C;AACA,aAAKP,OAAL,GAAeX,SAASiB,QAAT,CAAkBE,SAAlB,GAA8B,GAA7C;AACA,aAAKJ,UAAL,GAAkB,CAAlB;AACH,KAlBmB;;AAoBpBK,UAAO,cAAUC,SAAV,EAAqB;AACxB,aAAKC,OAAL,GAAiBD,YAAYrB,SAASiB,QAAT,CAAkBM,QAA/B,IAA4CF,YAAYrB,SAASiB,QAAT,CAAkBM,QAA1E,CAAD,GAAwF,EAAvG;AACH,KAtBmB;;AAwBpBC,kBAAe,wBAAY;AACvB,aAAKX,QAAL,GAAgBV,GAAGsB,EAAH,CAAMxB,MAAMyB,YAAN,CAAmB,CAAC,KAAKhB,MAAN,GAAe,CAAlC,EAAqC,KAAKA,MAAL,GAAc,CAAnD,CAAN,EAA6DT,MAAMyB,YAAN,CAAmB,CAAC,KAAKf,OAAN,GAAgB,CAAnC,EAAsC,KAAKA,OAAL,GAAe,CAArD,CAA7D,CAAhB;AACA;AACA,aAAKgB,WAAL;AACH,KA5BmB;;AA8BpBA,iBAAc,uBAAY;AACtB,aAAKf,OAAL,GAAe,KAAKgB,IAAL,CAAUC,QAAzB;AACA,aAAKf,QAAL,GAAgB,KAAKD,QAAL,CAAciB,GAAd,CAAkB,KAAKlB,OAAvB,CAAhB;AACH,KAjCmB;;AAmCpBmB,kBAAe,wBAAY;AACvB,aAAKnB,OAAL,GAAe,KAAKgB,IAAL,CAAUC,QAAzB;AACA,YAAMG,OAAQ,KAAKnB,QAAL,CAAciB,GAAd,CAAkB,KAAKlB,OAAvB,CAAd;AACA;AACA;AACA,eAAOoB,KAAKC,MAAL,MAAiB,KAAKX,OAA7B;AACH,KAzCmB;;AA2CpBY,YAAQ,gBAAUC,EAAV,EAAc;AAClB,gBAAQ,KAAK3B,aAAb;AACI,iBAAKV,YAAYW,MAAjB;AACI;AACA,qBAAKe,YAAL;AACA,qBAAKhB,aAAL,GAAqBV,YAAYsC,MAAjC;AACA;AACJ,iBAAKtC,YAAYsC,MAAjB;AACI,oBAAG,KAAKL,YAAL,EAAH,EAAwB;AACpB,yBAAKH,IAAL,CAAUS,IAAV,CAAe,cAAf;AACA,yBAAK7B,aAAL,GAAqBV,YAAYwC,QAAjC;AACH,iBAHD,MAGO;AACH,yBAAKX,WAAL;AACA,yBAAKC,IAAL,CAAUS,IAAV,CAAe,UAAf,EAA2B;AACvBL,8BAAM,KAAKlB;AADY,qBAA3B;AAGH;AACD;AACJ,iBAAKhB,YAAYwC,QAAjB;AACI,qBAAKvB,UAAL,IAAmBoB,EAAnB;AACA,oBAAG,KAAKpB,UAAL,IAAmB,CAAtB,EAAyB;AACrB,yBAAKA,UAAL,GAAkB,CAAlB;AACA,yBAAKP,aAAL,GAAqBV,YAAYW,MAAjC;AACH;AACD;AAvBR;AAyBH;;AArEmB,CAAT,CAAf","file":"MoveAI.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\move","sourcesContent":["/**\n * @fileoverview AI移动模拟器\n * @author meifan@gameley.cn (梅凡)\n */\n\nconst AIMoveState = require('Types').AIMoveState;\nconst GameData = require('GameData');\nconst Tools = require('Tools');\n\nconst MoveAI = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        _curMoveState: AIMoveState.Normal,\n        _Width: 0,\n        _height: 0,\n        _curPos: null,\n        _nextPos: null,\n        _moveDir: null,\n        _thinkTime: 1,\n    },\n\n    onLoad : function () {\n        // 宽高稍小于地图 以免被墙卡\n        this._Width = GameData.instance.mapWidth * 0.9;\n        this._height = GameData.instance.mapHeight * 0.9;\n        this._thinkTime = 2;\n    },\n\n    init : function (moveSpeed) {\n        this.moveMag = ((moveSpeed / GameData.instance.logicFps) * (moveSpeed / GameData.instance.logicFps)) + 30;\n    },\n\n    _findNextPos : function () {\n        this._nextPos = cc.v2(Tools.getRandomInt(-this._Width / 2, this._Width / 2), Tools.getRandomInt(-this._height / 2, this._height / 2));\n        // console.log('curPos is : ' + this._curPos + ', nextPos is ' + this._nextPos);\n        this._CalMoveDir();\n    },\n\n    _CalMoveDir : function () {\n        this._curPos = this.node.position;\n        this._moveDir = this._nextPos.sub(this._curPos);\n    },\n\n    _checkIfFind : function () {\n        this._curPos = this.node.position;\n        const dPos =  this._nextPos.sub(this._curPos);\n        // console.log('_curPos: ' + this._curPos + ', _nextPos: ' + this._nextPos + ', dPos is : ' + dPos + ',dPos.magSqr : ' + dPos.magSqr() + ',moveMag: ' + this.moveMag);\n        //TODO 应该得通过HeroMove的speed得出\n        return dPos.magSqr() <= this.moveMag;\n    },\n\n    update: function (dt) {\n        switch (this._curMoveState) {\n            case AIMoveState.Normal:\n                // 找寻下一个路点\n                this._findNextPos();\n                this._curMoveState = AIMoveState.Moving;\n                break;\n            case AIMoveState.Moving:\n                if(this._checkIfFind()) {\n                    this.node.emit('onStopMoving');\n                    this._curMoveState = AIMoveState.Thinking;\n                } else {\n                    this._CalMoveDir();\n                    this.node.emit('onMoveBy', {\n                        dPos: this._moveDir\n                    });\n                }\n                break;\n            case AIMoveState.Thinking:\n                this._thinkTime -= dt;\n                if(this._thinkTime <= 0) {\n                    this._thinkTime = 2;\n                    this._curMoveState = AIMoveState.Normal;\n                }\n                break;\n        }\n    }\n\n});"]}