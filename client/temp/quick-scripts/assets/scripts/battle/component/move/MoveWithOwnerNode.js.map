{"version":3,"sources":["MoveWithOwnerNode.js"],"names":["MoveWithOwnerNode","cc","Class","extends","Component","properties","_owner","_entity","_isSyncCulling","_followNode","init","owner","entity","followPlayer","node","updatePos","lateUpdate","isForce","ownerPos","getOwnerPos","nodePos","position","x","y","isMoving","emit","pos","worldPos","parent","convertToWorldSpaceAR","convertToNodeSpaceAR","v2","Vec2","ZERO"],"mappings":";;;;;;AAAA;;;;;AAKA;;;AAGA,IAAMA,oBAAoBC,GAAGC,KAAH,CAAS;AAC/BC,aAASF,GAAGG,SADmB;;AAG/BC,gBAAY;AACR;AACAC,gBAAQ,IAFA;AAGR;AACAC,iBAAS,IAJD;AAKRC,wBAAgB,KALR;AAMRC,qBAAa;AANL,KAHmB;;AAY/B;;;AAGAC,UAAM,cAAUC,KAAV,EAAiBC,MAAjB,EAAyBC,YAAzB,EAAuC;AACzC,aAAKP,MAAL,GAAcK,KAAd;AACA,aAAKJ,OAAL,GAAeK,MAAf;AACA,aAAKH,WAAL,GAAmBI,eAAeA,aAAaC,IAA5B,GAAmC,IAAtD;AACA,aAAKC,SAAL,CAAe,IAAf;AACH,KApB8B;;AAuB/BC,gBAAY,sBAAY;AACpB,YAAI,KAAKV,MAAT,EAAiB;AACb,iBAAKS,SAAL,CAAe,KAAf;AACH;AACJ,KA3B8B;;AA6B/BA,eAAW,mBAAUE,OAAV,EAAmB;AAC1B,YAAI,KAAKX,MAAT,EAAiB;AACb,gBAAMY,WAAW,KAAKC,WAAL,EAAjB;AACA,gBAAMC,UAAU,KAAKb,OAAL,CAAaO,IAAb,CAAkBO,QAAlC;AACA,gBAAIJ,WAAWC,SAASI,CAAT,KAAeF,QAAQE,CAAlC,IAAuCJ,SAASK,CAAT,KAAeH,QAAQG,CAAlE,EAAqE;AACjE,qBAAKhB,OAAL,CAAaO,IAAb,CAAkBO,QAAlB,GAA6BH,QAA7B;AACA,qBAAKM,QAAL,GAAgB,IAAhB;AACA,qBAAKV,IAAL,CAAUW,IAAV,CAAe,eAAf;AACH,aAJD,MAIO;AACH,oBAAI,KAAKD,QAAL,KAAkB,IAAtB,EAA4B;AACxB,yBAAKA,QAAL,GAAgB,KAAhB;AACA,yBAAKV,IAAL,CAAUW,IAAV,CAAe,cAAf;AACH;AACJ;AACJ;AACJ,KA5C8B;;AA8C/BN,iBAAa,uBAAY;AACrB,YAAIO,MAAM,IAAV;AACA,YAAI,KAAKjB,WAAT,EAAsB;AAClB,gBAAIkB,WAAW,KAAKlB,WAAL,CAAiBmB,MAAjB,CAAwBC,qBAAxB,CAA8C,KAAKpB,WAAnD,CAAf;AACA,gBAAImB,SAAS,KAAKrB,OAAL,CAAaO,IAAb,CAAkBc,MAAlB,GAA2B,KAAKrB,OAAL,CAAaO,IAAb,CAAkBc,MAA7C,GAAsD,KAAKrB,OAAL,CAAaO,IAAhF;AACAY,kBAAME,OAAOE,oBAAP,CAA4BH,QAA5B,CAAN;AACH,SAJD,MAIO;AACHD,kBAAM,KAAKpB,MAAL,GAAcL,GAAG8B,EAAH,CAAM,KAAKzB,MAAL,CAAYe,QAAlB,CAAd,GAA4CpB,GAAG+B,IAAH,CAAQC,IAA1D;AACH;AACD,eAAOP,GAAP;AACH;AAxD8B,CAAT,CAA1B","file":"MoveWithOwnerNode.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\component\\move","sourcesContent":["/**\r\n * @fileoverview 位置保持和另一个node相同\r\n * @author meifan@gameley.cn (梅凡)\r\n */\r\n\r\n/**\r\n * 初始化时指定跟随的node update时设置位置\r\n */\r\nconst MoveWithOwnerNode = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        /** @type {EntityBase} */\r\n        _owner: null,\r\n        /** @type {EntityBase} */\r\n        _entity: null,\r\n        _isSyncCulling: false,\r\n        _followNode: null,\r\n    },\r\n\r\n    /**\r\n     * 初始化\r\n     */\r\n    init: function (owner, entity, followPlayer) {\r\n        this._owner = owner;\r\n        this._entity = entity;\r\n        this._followNode = followPlayer ? followPlayer.node : null; \r\n        this.updatePos(true);\r\n    },\r\n\r\n\r\n    lateUpdate: function () {\r\n        if (this._owner) {\r\n            this.updatePos(false);\r\n        }\r\n    },\r\n\r\n    updatePos: function (isForce) {\r\n        if (this._owner) {\r\n            const ownerPos = this.getOwnerPos();\r\n            const nodePos = this._entity.node.position;\r\n            if (isForce || ownerPos.x !== nodePos.x || ownerPos.y !== nodePos.y) {\r\n                this._entity.node.position = ownerPos;\r\n                this.isMoving = true;\r\n                this.node.emit('heroStartMove');\r\n            } else {\r\n                if (this.isMoving === true) {\r\n                    this.isMoving = false;\r\n                    this.node.emit('heroStopMove');\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    getOwnerPos: function () {\r\n        var pos = null;\r\n        if (this._followNode) {\r\n            var worldPos = this._followNode.parent.convertToWorldSpaceAR(this._followNode);\r\n            var parent = this._entity.node.parent ? this._entity.node.parent : this._entity.node;\r\n            pos = parent.convertToNodeSpaceAR(worldPos);\r\n        } else {\r\n            pos = this._owner ? cc.v2(this._owner.position) : cc.Vec2.ZERO;\r\n        }\r\n        return pos;\r\n    },\r\n});"]}