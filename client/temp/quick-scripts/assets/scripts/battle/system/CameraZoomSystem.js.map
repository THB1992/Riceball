{"version":3,"sources":["CameraZoomSystem.js"],"names":["Tools","require","GameData","ZoomMin","ZoomMax","MoveZoomMin","MoveZoomMax","cc","Class","extends","Component","properties","_knifeNum","_isMove","_curZoom","_numZoom","_moveZoom","_zoomDirty","_zoomSpeedDirty","_knifeMin","_knifeMax","_zoomMultip","_newZoomMultip","init","entityPlayer","cameraZoomCtrl","knifesComp","followPlayer","knivesCmp","cameraZoomSys","instance","knifeMin","knifeMax","setCameraZoomMultip","multip","zoomPer","update","dt","knives","length","lerp","inverseLerp","clamp","speedRate","misc","isMove","setCameraZoomImmediately","setCameraZoom"],"mappings":"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","file":"CameraZoomSystem.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\system","sourcesContent":["/**\n * @fileoverview 相机变焦系统\n * @author meifan@gameley.cn (梅凡)\n */\n\nconst Tools = require('Tools');\nconst GameData = require('GameData');\nconst ZoomMin = 0.55;\nconst ZoomMax = 1.0;\nconst MoveZoomMin = 0.85;\nconst MoveZoomMax = 1.15;\n\n\n/**\n * 相机根据玩家状态进行变焦\n */\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        _knifeNum: 0,\n        _isMove: false,\n        _curZoom: 1,\n        _numZoom: 1,\n        _moveZoom: 1,\n        _zoomDirty: false,\n        _zoomSpeedDirty: false,\n        _knifeMin: 9,\n        _knifeMax: 20,\n        _zoomMultip: 1,\n        _newZoomMultip: 1,\n    },\n\n    init: function (entityPlayer, cameraZoomCtrl) {\n        this.knifesComp = entityPlayer.followPlayer.knivesCmp;\n        this.cameraZoomCtrl = cameraZoomCtrl;\n        entityPlayer.cameraZoomSys = this;\n\n        this._knifeNum = 0;\n        this._isMove = false;\n        this._curZoom = 1;\n        this._knifeMin = GameData.instance.knifeMin;\n        this._knifeMax = GameData.instance.knifeMax;\n    },\n\n    setCameraZoomMultip: function (multip) {\n        this._newZoomMultip = multip;\n        this.zoomPer = this._newZoomMultip - this._zoomMultip;\n    },\n\n    update: function (dt) {\n\n        if (this._newZoomMultip !== this._zoomMultip) {\n            this._zoomMultip += this.zoomPer * dt;\n            if (this.zoomPer > 0) {\n                if (this._zoomMultip > this._newZoomMultip) {\n                    this._zoomMultip = this._newZoomMultip;\n                }\n            } else {\n                if (this._zoomMultip < this._newZoomMultip) {\n                    this._zoomMultip = this._newZoomMultip;\n                }\n            }\n\n            this._zoomDirty = true;\n        }\n\n\n\n        if (this._knifeNum !== this.knifesComp.knives.length) {\n            this._zoomSpeedDirty = this.knifesComp.knives.length < this._knifeNum && this._isMove;\n            this._knifeNum = this.knifesComp.knives.length;\n            // 根据飞刀数量确定当前zoom\n            // const lerp = Tools.inverseLerp(this._knifeMax, this._knifeMin, this._knifeNum);\n            var lerp = Tools.inverseLerp(this._knifeMin, this._knifeMax, this._knifeNum);\n            lerp = Tools.clamp(0, 1, lerp);\n            GameData.instance.speedRate = cc.misc.lerp(1, 1.5, lerp);\n            this._numZoom = cc.misc.lerp(ZoomMax, ZoomMin, lerp);\n\n            this._zoomDirty = true;\n        }\n\n        if (this._isMove !== this.knifesComp.isMove) {\n            this._isMove = this.knifesComp.isMove;\n            // 根据是否移动确定当前zoom\n            this._moveZoom = this._isMove ? MoveZoomMin : MoveZoomMax;\n\n            this._zoomDirty = true;\n            this._zoomSpeedDirty = false;\n        }\n\n        if (this._zoomDirty) {\n            this._zoomDirty = false;\n\n            this._curZoom = this._numZoom * this._moveZoom;\n            if (this._zoomSpeedDirty) {\n                this._zoomSpeedDirty = false;\n                this.cameraZoomCtrl.setCameraZoomImmediately(this._curZoom / this._zoomMultip);\n            } else {\n                this.cameraZoomCtrl.setCameraZoom(this._curZoom / this._zoomMultip);\n            }\n        }\n    }\n});"]}