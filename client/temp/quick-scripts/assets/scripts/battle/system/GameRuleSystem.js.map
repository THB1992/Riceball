{"version":3,"sources":["GameRuleSystem.js"],"names":["Tools","require","GameRuleSystem","cc","Class","extends","Component","properties","_countDownTime","players","cleanUp","init","gameOverFunc","localPlayer","entityPlayers","gameTime","reviveFunc","_gameOverFunc","_localPlayer","player","push","_allDead","_reviveFunc","isRevive","isGameOver","updateGameLogic","dt","onGameOver","firstDead","onRevive","isDead","isLocal","onContinue"],"mappings":";;;;;;AAAA;;;;;AAKA,IAAMA,QAAQC,QAAQ,OAAR,CAAd;;AAEA,IAAMC,iBAAiBC,GAAGC,KAAH,CAAS;AAC5BC,aAASF,GAAGG,SADgB;;AAG5BC,gBAAY;AACRC,wBAAgB,EADR;AAERC,iBAAS;AAFD,KAHgB;;AAQ5BC,aAAS,mBAAY;AACjB,aAAKD,OAAL,GAAe,EAAf;AACH,KAV2B;;AAY5BE,UAAM,cAAUC,YAAV,EAAwBC,WAAxB,EAAqCC,aAArC,EAAoDC,QAApD,EAA8DC,UAA9D,EAA0E;AAC5E,aAAKC,aAAL,GAAqBL,YAArB;AACA,aAAKM,YAAL,GAAoBL,WAApB;AAF4E;AAAA;AAAA;;AAAA;AAG5E,iCAAmBC,aAAnB,8HAAkC;AAAA,oBAAzBK,MAAyB;;AAC9B,qBAAKV,OAAL,CAAaW,IAAb,CAAkBD,MAAlB;AACH;AAL2E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAM5E,aAAKX,cAAL,GAAsBO,QAAtB;AACA,aAAKM,QAAL,GAAgB,KAAhB;AACA,aAAKC,WAAL,GAAmBN,UAAnB;AACA,aAAKO,QAAL,GAAgB,KAAhB;AACA,aAAKC,UAAL,GAAkB,KAAlB;AACH,KAvB2B;;AAyB5BC,qBAAiB,yBAAUC,EAAV,EAAc;AAC3B,YAAI,KAAKF,UAAT,EAAqB;AACrB,aAAKhB,cAAL,IAAuBkB,EAAvB;AACA,YAAI,KAAKlB,cAAL,IAAuB,CAA3B,EAA8B;AAC1B;AACA,iBAAKmB,UAAL;AACA;AACH;;AAED,YAAI,KAAKT,YAAL,CAAkBU,SAAlB,IAA+B,CAAC,KAAKL,QAAzC,EAAmD;AAC/C,iBAAKM,QAAL;AACA;AACH;;AAED,YAAI,KAAKX,YAAL,CAAkBY,MAAtB,EAA8B;AAC1B;AACA,iBAAKH,UAAL;AACA;AACH;;AAED,aAAKN,QAAL,GAAgB,IAAhB;AApB2B;AAAA;AAAA;;AAAA;AAqB3B,kCAAmB,KAAKZ,OAAxB,mIAAiC;AAAA,oBAAxBU,MAAwB;;AAC7B,oBAAIA,OAAOY,OAAX,EAAoB;AAChB;AACA;AACH;AACD,oBAAI,CAACZ,OAAOW,MAAZ,EAAoB;AAChB,yBAAKT,QAAL,GAAgB,KAAhB;AACA;AACH;AACJ;AA9B0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA+B3B,YAAI,KAAKA,QAAT,EAAmB;AACf;AACA,iBAAKM,UAAL;AACA;AACH;AACJ,KA7D2B;;AA+D5BA,gBAAY,sBAAY;AACpB,YAAI,KAAKV,aAAT,EAAwB;AACpB,iBAAKA,aAAL;AACA,iBAAKA,aAAL,GAAqB,IAArB;AACA,iBAAKO,UAAL,GAAkB,IAAlB;AACH;AACJ,KArE2B;;AAuE5BK,cAAU,oBAAY;AAClB,YAAI,KAAKP,WAAT,EAAsB;AAClB,iBAAKA,WAAL;AACA;AACA,iBAAKC,QAAL,GAAgB,IAAhB;AACH;AACJ,KA7E2B;;AA+E5BS,gBAAY,sBAAY;AACpB,aAAKT,QAAL,GAAgB,KAAhB;AACH;AAjF2B,CAAT,CAAvB","file":"GameRuleSystem.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\system","sourcesContent":["/**\n * @fileoverview GameRuleSystem\n * @author meifan@gameley.cn (梅凡)\n */\n\nconst Tools = require('Tools');\n\nconst GameRuleSystem = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        _countDownTime: 99,\n        players: [],\n    },\n\n    cleanUp: function () {\n        this.players = [];\n    },\n\n    init: function (gameOverFunc, localPlayer, entityPlayers, gameTime, reviveFunc) {\n        this._gameOverFunc = gameOverFunc;\n        this._localPlayer = localPlayer;\n        for (var player of entityPlayers) {\n            this.players.push(player);\n        }\n        this._countDownTime = gameTime;\n        this._allDead = false;\n        this._reviveFunc = reviveFunc;\n        this.isRevive = false;\n        this.isGameOver = false;\n    },\n\n    updateGameLogic: function (dt) {\n        if (this.isGameOver) return;\n        this._countDownTime -= dt;\n        if (this._countDownTime <= 0) {\n            // 游戏结束\n            this.onGameOver();\n            return;\n        }\n\n        if (this._localPlayer.firstDead && !this.isRevive) {\n            this.onRevive();\n            return;\n        }\n\n        if (this._localPlayer.isDead) {\n            // 游戏结束\n            this.onGameOver();\n            return;\n        }\n\n        this._allDead = true;\n        for (var player of this.players) {\n            if (player.isLocal) {\n                // 排除玩家自己\n                continue;\n            }\n            if (!player.isDead) {\n                this._allDead = false;\n                break;\n            }\n        }\n        if (this._allDead) {\n            // 游戏结束\n            this.onGameOver();\n            return;\n        }\n    },\n\n    onGameOver: function () {\n        if (this._gameOverFunc) {\n            this._gameOverFunc();\n            this._gameOverFunc = null;\n            this.isGameOver = true;\n        }\n    },\n\n    onRevive: function () {\n        if (this._reviveFunc) {\n            this._reviveFunc();\n            // this._reviveFunc = null;\n            this.isRevive = true;\n        }\n    },\n\n    onContinue: function () {\n        this.isRevive = false;\n    }\n});"]}