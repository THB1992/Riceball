{"version":3,"sources":["KillMsgListener.js"],"names":["AudioEngine","require","SoundID","killSounds","doublekill","tribblekill","quadrkill","pandakill","godlike","PlayerData","PlatformMgr","CustomFunnelEvent","KillMsgListener","cc","Class","extends","Component","properties","players","isfirstBlood","isGuide","cleanUp","init","entityPlayers","uiMgr","player","push","instance","node","on","killMessageShow","event","knife","deadHero","myTid","tag","otherTid","myHero","otherHero","hero","teamID","beKilled","playSound","firstblood","showKillMsg","isLocal","showKillNotice","killNum","length","isFristGame","notifyFunnelEvent","Kill_One","Kill_Two","Kill_Three"],"mappings":"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","file":"KillMsgListener.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\system","sourcesContent":["/**\n * @fileoverview KillMsgListener\n * @author meifan@gameley.cn (梅凡)\n */\n\n\nconst AudioEngine = require('AudioEngine');\nconst SoundID = require('Types').SoundID;\nconst killSounds = [SoundID.doublekill, SoundID.tribblekill, SoundID.quadrkill, SoundID.pandakill, SoundID.godlike];\nconst PlayerData = require('PlayerData');\nconst PlatformMgr = require('PlatformMgr');\nconst CustomFunnelEvent = require('Types').CustomFunnelEvent;\n\nconst KillMsgListener = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        players: [],\n        isfirstBlood: false,\n        isGuide: false\n    },\n\n    cleanUp: function () {\n        this.players = [];\n    },\n\n    init: function (entityPlayers, uiMgr) {\n        for (var player of entityPlayers) {\n            this.players.push(player);\n        }\n        this.uiMgr = uiMgr;\n\n        this.isGuide = PlayerData.instance.isGuide;\n\n        this.node.on('killMessageShow', this.killMessageShow, this)\n    },\n\n    killMessageShow(event) {\n        const knife = event[0];\n        const deadHero = event[1];\n\n        const myTid = knife.tag;\n        const otherTid = deadHero.tag;\n\n        var myHero = null;\n        var otherHero = null;\n\n        for (var hero of this.players) {\n            if (hero.teamID === myTid) {\n                myHero = hero;\n                continue;\n            }\n            if (hero.teamID === otherTid) {\n                otherHero = hero;\n            }\n        }\n\n        if (otherHero && otherHero.beKilled()) {\n            // 玩家被杀有可能会无敌导致没有真的死亡 就不需要走音效、弹窗等\n\n            if (!this.isfirstBlood) {\n                this.isfirstBlood = true;\n                AudioEngine.instance.playSound(SoundID.firstblood);\n            }\n\n            this.uiMgr.showKillMsg(myHero, otherHero);\n            if (myHero.isLocal) {\n                if(!this.isGuide) {\n                    this.uiMgr.showKillNotice(myHero.killNum);\n                }\n\n                if (myHero.killNum > 5) {\n                    AudioEngine.instance.playSound(killSounds[killSounds.length - 1]);\n                } else if (myHero.killNum >= 2) {\n                    AudioEngine.instance.playSound(killSounds[myHero.killNum - 2]);\n                }\n\n                if(PlayerData.instance.isFristGame()) {\n                    if (myHero.killNum === 1) {\n                        PlatformMgr.notifyFunnelEvent(CustomFunnelEvent.Kill_One);\n                    } else if (myHero.killNum === 2) {\n                        PlatformMgr.notifyFunnelEvent(CustomFunnelEvent.Kill_Two);\n                    } else if (myHero.killNum === 3) {\n                        PlatformMgr.notifyFunnelEvent(CustomFunnelEvent.Kill_Three);\n                    }\n                }\n            }\n        }\n    }\n});"]}