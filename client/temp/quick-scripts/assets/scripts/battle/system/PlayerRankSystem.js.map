{"version":3,"sources":["PlayerRankSystem.js"],"names":["PlayerRankSystem","cc","Class","extends","Component","properties","players","cleanUp","init","entityPlayers","localPlayer","player","push","updateGameLogic","dt","sort","a","b","getKnifeNum","index","indexOf","aValue","beKilled","bValue","rank"],"mappings":";;;;;;AAAA;;;;;AAMA,IAAMA,mBAAmBC,GAAGC,KAAH,CAAS;AAC/BC,aAASF,GAAGG,SADmB;;AAG9BC,gBAAY;AACRC,iBAAS;AADD,KAHkB;;AAO9BC,aAAS,mBAAY;AACjB,aAAKD,OAAL,GAAe,EAAf;AACH,KAT6B;;AAW9BE,UAAM,cAAUC,aAAV,EAAyBC,WAAzB,EAAsC;AAAA;AAAA;AAAA;;AAAA;AACxC,iCAAkBD,aAAlB,8HAAiC;AAAA,oBAAzBE,MAAyB;;AAC7B,qBAAKL,OAAL,CAAaM,IAAb,CAAkBD,MAAlB;AACH;AAHuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAIxC,aAAKD,WAAL,GAAmBA,WAAnB;AACH,KAhB6B;;AAkB9BG,mBAlB8B,2BAkBdC,EAlBc,EAkBV;AAChB,aAAKR,OAAL,CAAaS,IAAb,CAAkB,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAC9B,mBAAOA,EAAEC,WAAF,KAAkBF,EAAEE,WAAF,EAAzB;AACH,SAFD;;AAIA,YAAIC,QAAQ,KAAKb,OAAL,CAAac,OAAb,CAAqB,KAAKV,WAA1B,CAAZ;AACA,eAAMS,QAAQ,CAAd,EAAiB;AACb,gBAAG,KAAKb,OAAL,CAAaa,QAAQ,CAArB,EAAwBD,WAAxB,OAA0C,KAAKR,WAAL,CAAiBQ,WAAjB,EAA7C,EAA6E;AACzE,qBAAKZ,OAAL,CAAaa,KAAb,IAAsB,KAAKb,OAAL,CAAaa,QAAQ,CAArB,CAAtB;AACA,qBAAKb,OAAL,CAAaa,QAAQ,CAArB,IAA0B,KAAKT,WAA/B;AACAS;AACH,aAJD,MAIO;AACH;AACH;AACJ;;AAED,aAAKb,OAAL,CAAaS,IAAb,CAAkB,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAC9B,gBAAMI,SAASL,EAAEM,QAAF,KAAe,CAAC,CAAhB,GAAmB,CAAlC;AACA,gBAAMC,SAASN,EAAEK,QAAF,KAAe,CAAC,CAAhB,GAAmB,CAAlC;AACA,mBAAOC,SAASF,MAAhB;;AAEA;AACH,SAND;;AAQAF,gBAAQ,CAAR;AAxBgB;AAAA;AAAA;;AAAA;AAyBhB,kCAAkB,KAAKb,OAAvB,mIAAgC;AAAA,oBAAxBK,MAAwB;;AAC5B;AACA;AACA;AACA;AACAA,uBAAOa,IAAP,GAAcL,KAAd;AACAA;AACH;AAhCe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiCnB;AAnD6B,CAAT,CAAzB","file":"PlayerRankSystem.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\system","sourcesContent":["/**\n * @fileoverview PlayerRankSystem\n * @author meifan@gameley.cn (梅凡)\n */\n\n\nconst PlayerRankSystem = cc.Class({\n   extends: cc.Component,\n\n    properties: {\n        players: []\n    },\n\n    cleanUp: function () {\n        this.players = [];\n    },\n\n    init: function (entityPlayers, localPlayer) {\n        for(var player of entityPlayers) {\n            this.players.push(player);\n        }\n        this.localPlayer = localPlayer;\n    },\n\n    updateGameLogic(dt) {\n        this.players.sort(function (a, b) {\n            return b.getKnifeNum() - a.getKnifeNum();\n        });\n        \n        var index = this.players.indexOf(this.localPlayer);\n        while(index > 0) {\n            if(this.players[index - 1].getKnifeNum() === this.localPlayer.getKnifeNum()) {\n                this.players[index] = this.players[index - 1];\n                this.players[index - 1] = this.localPlayer;\n                index --;\n            } else {\n                break;\n            }\n        }\n\n        this.players.sort(function (a, b) {\n            const aValue = a.beKilled() ? -1: 0;\n            const bValue = b.beKilled() ? -1: 0;\n            return bValue - aValue;\n\n            // return !b.beKilled() && a.beKilled() ? 1 : 0;\n        });\n\n        index = 1;\n        for(var player of this.players) {\n            // if(player.beKilled()) {\n            //     player.setFinalRank(index);\n            //     continue;\n            // }\n            player.rank = index;\n            index ++;\n        }\n    }\n});"]}