{"version":3,"sources":["ItemShopItem.js"],"names":["PayMgr","require","AdvertMgr","PlayerData","AdverType","Tools","ConfigData","cc","Class","extends","Component","properties","icon","Sprite","desc","Label","price","Node","free","tv","buyBtn","remainTime","_world","_lastFreeDiamondTime","_curTime","init","data","world","_data","getComponent","string","isAdItem","active","instance","getCanGetFreeDiamond","getLastFreeDiamondTime","resetPrice","priceString","resetIcon","spFrame","spriteFrame","onBuyBtnClick","getIsPaying","closeFunc","isSuccess","setIsPaying","fireBaseEvent","updateLastFreeDiamondTime","setFreeBuyBtnActive","updateZongZi","diamond","uiMgr","showTips","getStringByFormat","getUITipStr","errorFunc","setTimeout","showAdver","ShopFreeDiamond","payByIndex","payIndex","isActive","update","dt","timeString","getRemainTimeStr","getCurTime"],"mappings":";;;;;;AAAA,IAAMA,SAASC,QAAQ,QAAR,CAAf;AACA,IAAMC,YAAYD,QAAQ,WAAR,CAAlB;AACA,IAAME,aAAaF,QAAQ,YAAR,CAAnB;AACA,IAAMG,YAAYH,QAAQ,OAAR,EAAiBG,SAAnC;AACA,IAAMC,QAAQJ,QAAQ,OAAR,CAAd;AACA,IAAMK,aAAaL,QAAQ,YAAR,CAAnB;;AAEAM,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,cAAML,GAAGM,MADD;AAERC,cAAMP,GAAGQ,KAFD;AAGRC,eAAOT,GAAGU,IAHF;AAIRC,cAAMX,GAAGU,IAJD;AAKRE,YAAIZ,GAAGU,IALC;AAMRG,gBAAQb,GAAGU,IANH;AAORI,oBAAYd,GAAGQ,KAPP;;AASRO,gBAAQf,GAAGU,IATH;AAURM,8BAAsB,CAVd;AAWRC,kBAAU;AAXF,KAHP;;AAiBL;;AAEA;;AAEAC,QArBK,gBAqBAC,IArBA,EAqBMC,KArBN,EAqBa;AACd,aAAKC,KAAL,GAAaF,IAAb;AACA,aAAKJ,MAAL,GAAcK,KAAd;AACA,aAAKb,IAAL,CAAUe,YAAV,CAAuBtB,GAAGQ,KAA1B,EAAiCe,MAAjC,GAA0C,KAAKF,KAAL,CAAWd,IAAX,GAAkB,KAAKc,KAAL,CAAWd,IAA7B,GAAoC,EAA9E;AACA,YAAI,CAAC,KAAKc,KAAL,CAAWG,QAAhB,EAA0B;AACtB,iBAAKf,KAAL,CAAWa,YAAX,CAAwBtB,GAAGQ,KAA3B,EAAkCe,MAAlC,GAA2C,KAAKF,KAAL,CAAWZ,KAAX,GAAmB,KAAKY,KAAL,CAAWZ,KAA9B,GAAsC,EAAjF;AACH,SAFD,MAEO;AACH,iBAAKG,EAAL,CAAQa,MAAR,GAAiB,IAAjB;AACA,iBAAKd,IAAL,CAAUc,MAAV,GAAmB,IAAnB;AACA,iBAAKhB,KAAL,CAAWgB,MAAX,GAAoB,KAApB;;AAEA,iBAAKZ,MAAL,CAAYY,MAAZ,GAAqB7B,WAAW8B,QAAX,CAAoBC,oBAApB,EAArB;AACA,iBAAKX,oBAAL,GAA4BpB,WAAW8B,QAAX,CAAoBE,sBAApB,EAA5B;AACH;AAEJ,KApCI;AAsCLC,cAtCK,sBAsCMC,WAtCN,EAsCmB;AACpB,YAAI,KAAKT,KAAL,CAAWG,QAAf,EAAyB;AACzB,aAAKf,KAAL,CAAWa,YAAX,CAAwBtB,GAAGQ,KAA3B,EAAkCe,MAAlC,GAA2CO,WAA3C;AACH,KAzCI;AA2CLC,aA3CK,qBA2CKC,OA3CL,EA2Cc;AACf,aAAK3B,IAAL,CAAU4B,WAAV,GAAwBD,OAAxB;AACH,KA7CI;;;AA+CLE,mBAAe,yBAAY;AAAA;;AACvB,YAAIzC,OAAOiC,QAAP,CAAgBS,WAAhB,EAAJ,EAAmC;AAC/B;AACH;;AAED,YAAIC,YAAY,SAAZA,SAAY,CAACC,SAAD,EAAe;AAC3B5C,mBAAOiC,QAAP,CAAgBY,WAAhB,CAA4B,KAA5B;AACA,gBAAID,SAAJ,EAAe;AACX1C,0BAAU+B,QAAV,CAAmBa,aAAnB,CAAiC,0BAAjC,EAA4D,YAA5D,EACI,MAAKlB,KAAL,CAAWG,QAAX,GAAsB,iBAAtB,GAA0C,UAD9C;AAEA,oBAAI,MAAKH,KAAL,CAAWG,QAAf,EAAyB;AACrB5B,+BAAW8B,QAAX,CAAoBc,yBAApB;AACA,0BAAKC,mBAAL,CAAyB,KAAzB;AACH;AACD7C,2BAAW8B,QAAX,CAAoBgB,YAApB,CAAiC,MAAKrB,KAAL,CAAWsB,OAA5C;AACA,sBAAK5B,MAAL,CAAY6B,KAAZ,CAAkBC,QAAlB,CAA2B/C,MAAMgD,iBAAN,CAAwB/C,WAAW2B,QAAX,CAAoBqB,WAApB,CAAgC,EAAhC,CAAxB,EAA6D,MAAK1B,KAAL,CAAWsB,OAAxE,CAA3B;AACH;AACJ,SAZD;;AAcA,YAAIK,YAAY,SAAZA,SAAY,GAAM;AAClBvD,mBAAOiC,QAAP,CAAgBY,WAAhB,CAA4B,KAA5B;AACA,kBAAKvB,MAAL,CAAY6B,KAAZ,CAAkBC,QAAlB,CAA2B/C,MAAMgD,iBAAN,CAAwB/C,WAAW2B,QAAX,CAAoBqB,WAApB,CAAgC,EAAhC,CAAxB,CAA3B;AACH,SAHD;;AAKAE,mBAAW,YAAM;AACbxD,mBAAOiC,QAAP,CAAgBY,WAAhB,CAA4B,KAA5B;AACH,SAFD,EAEG,IAFH;AAGA,YAAI,KAAKjB,KAAL,CAAWG,QAAf,EAAyB;AACrB7B,sBAAU+B,QAAV,CAAmBa,aAAnB,CAAiC,kBAAjC,EAAoD,YAApD,EAAiE,iBAAjE;;AAEA5C,sBAAU+B,QAAV,CAAmBwB,SAAnB,CAA6BrD,UAAUsD,eAAvC,EAAwDf,SAAxD;AACH,SAJD,MAIO;AACHzC,sBAAU+B,QAAV,CAAmBa,aAAnB,CAAiC,kBAAjC,EAAoD,YAApD,EAAiE,UAAjE;;AAEA9C,mBAAOiC,QAAP,CAAgBY,WAAhB,CAA4B,IAA5B;AACA7C,mBAAOiC,QAAP,CAAgB0B,UAAhB,CAA2B,KAAK/B,KAAL,CAAWgC,QAAtC,EAAgDjB,SAAhD,EAA2DY,SAA3D;AACH;AACJ,KApFI;;AAsFLP,yBAAqB,6BAASa,QAAT,EAAmB;AACpC,aAAKtC,oBAAL,GAA4BpB,WAAW8B,QAAX,CAAoBE,sBAApB,EAA5B;AACA,aAAKf,MAAL,CAAYY,MAAZ,GAAqB6B,QAArB;AACH,KAzFI;;AA2FLC,UA3FK,kBA2FGC,EA3FH,EA2FO;AACR,YAAI,KAAKnC,KAAL,CAAWG,QAAX,IAAuB,CAAC,KAAKX,MAAL,CAAYY,MAAxC,EAAgD;AAC5C,gBAAI7B,WAAW8B,QAAX,CAAoBC,oBAApB,EAAJ,EAAgD;AAC5C,qBAAKc,mBAAL,CAAyB,IAAzB;AACA;AACH;AACD,gBAAIgB,aAAa3D,MAAM4D,gBAAN,CAAuB9D,WAAW8B,QAAX,CAAoBiC,UAApB,EAAvB,EAAyD,KAAK3C,oBAAL,GAA4B,KAAG,EAAH,GAAM,EAAN,GAAS,IAA9F,CAAjB;AACA,gBAAIyC,cAAc,KAAKxC,QAAvB,EAAiC;AAC7B,qBAAKA,QAAL,GAAgBwC,UAAhB;AACA,qBAAK3C,UAAL,CAAgBS,MAAhB,GAAyB,KAAKN,QAA9B;AACH;AACJ;AACJ;AAvGI,CAAT","file":"ItemShopItem.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui","sourcesContent":["const PayMgr = require('PayMgr');\nconst AdvertMgr = require('AdvertMgr');\nconst PlayerData = require('PlayerData');\nconst AdverType = require('Types').AdverType;\nconst Tools = require('Tools');\nconst ConfigData = require('ConfigData');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        icon: cc.Sprite,\n        desc: cc.Label,\n        price: cc.Node,\n        free: cc.Node,\n        tv: cc.Node,\n        buyBtn: cc.Node,\n        remainTime: cc.Label,\n\n        _world: cc.Node,\n        _lastFreeDiamondTime: 0,\n        _curTime: '',\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    init(data, world) {\n        this._data = data;\n        this._world = world;\n        this.desc.getComponent(cc.Label).string = this._data.desc ? this._data.desc : '';\n        if (!this._data.isAdItem) {\n            this.price.getComponent(cc.Label).string = this._data.price ? this._data.price : '';\n        } else {\n            this.tv.active = true;\n            this.free.active = true;\n            this.price.active = false;\n\n            this.buyBtn.active = PlayerData.instance.getCanGetFreeDiamond();\n            this._lastFreeDiamondTime = PlayerData.instance.getLastFreeDiamondTime();\n        }\n\n    },\n\n    resetPrice(priceString) {\n        if (this._data.isAdItem) return;\n        this.price.getComponent(cc.Label).string = priceString;\n    },\n\n    resetIcon(spFrame) {\n        this.icon.spriteFrame = spFrame;\n    },\n\n    onBuyBtnClick: function () {\n        if (PayMgr.instance.getIsPaying()) {\n            return;\n        }\n\n        var closeFunc = (isSuccess) => {\n            PayMgr.instance.setIsPaying(false);\n            if (isSuccess) {\n                AdvertMgr.instance.fireBaseEvent(\"purchase_product_success\",\"product_id\",\n                    this._data.isAdItem ? \"ads for diamond\" : \"diamonds\");\n                if (this._data.isAdItem) {\n                    PlayerData.instance.updateLastFreeDiamondTime();\n                    this.setFreeBuyBtnActive(false);\n                }\n                PlayerData.instance.updateZongZi(this._data.diamond);\n                this._world.uiMgr.showTips(Tools.getStringByFormat(ConfigData.instance.getUITipStr(15), this._data.diamond));\n            }\n        }\n\n        var errorFunc = () => {\n            PayMgr.instance.setIsPaying(false);\n            this._world.uiMgr.showTips(Tools.getStringByFormat(ConfigData.instance.getUITipStr(23)));\n        }\n\n        setTimeout(() => {\n            PayMgr.instance.setIsPaying(false);\n        }, 1800)\n        if (this._data.isAdItem) {\n            AdvertMgr.instance.fireBaseEvent(\"purchase_product\",\"product_id\",\"ads for diamond\");\n\n            AdvertMgr.instance.showAdver(AdverType.ShopFreeDiamond, closeFunc)\n        } else {\n            AdvertMgr.instance.fireBaseEvent(\"purchase_product\",\"product_id\",\"diamonds\");\n\n            PayMgr.instance.setIsPaying(true);\n            PayMgr.instance.payByIndex(this._data.payIndex, closeFunc, errorFunc);\n        }\n    },\n\n    setFreeBuyBtnActive: function(isActive) {\n        this._lastFreeDiamondTime = PlayerData.instance.getLastFreeDiamondTime();\n        this.buyBtn.active = isActive;\n    },\n\n    update (dt) {\n        if (this._data.isAdItem && !this.buyBtn.active) {\n            if (PlayerData.instance.getCanGetFreeDiamond()) {\n                this.setFreeBuyBtnActive(true);\n                return;\n            }\n            var timeString = Tools.getRemainTimeStr(PlayerData.instance.getCurTime(), this._lastFreeDiamondTime + 24*60*60*1000);\n            if (timeString != this._curTime) {\n                this._curTime = timeString;\n                this.remainTime.string = this._curTime;\n            }\n        }\n    },\n});"]}