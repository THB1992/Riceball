{"version":3,"sources":["PanelShop.js"],"names":["PayMgr","require","ConfigData","PlatformMgr","PanelShop","cc","Class","extends","Component","properties","itemPrefab","Node","content","waitNode","iconSpriteFrames","SpriteFrame","_itemNodes","_isInit","_world","_priceString","callback","onLoad","queryCallbackFunc","priceString","console","log","setWaitNodeActive","setTimeout","instance","requestProductPrices","init","world","initItems","isActive","active","shopDatas","getShopDatas","i","length","data","itemNode","instantiate","parent","itemNodeSc","getComponent","iconIndex","resetIcon","push","resetPrices","splitStr","isIosApp","prices","split","pricesnew","index","price","includes","resetPrice","close","node","update","dt","getIsPaying"],"mappings":"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","file":"PanelShop.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui","sourcesContent":["/**\n * @fileoverview PanelShop\n */\nconst PayMgr = require('PayMgr');\nconst ConfigData = require('ConfigData');\nconst PlatformMgr = require('PlatformMgr');\n\n//假期排行\nconst PanelShop = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        itemPrefab: cc.Node,\n        content: cc.Node,\n        waitNode: cc.Node,\n        iconSpriteFrames: [cc.SpriteFrame],\n        \n        _itemNodes: [],\n        _isInit: false,\n        _world: cc.Node,\n        _priceString: '',\n        callback : null\n    },\n    // LIFE-CYCLE CALLBACKS:\n    onLoad() {\n\n        var queryCallbackFunc = (priceString) => {\n            console.log('onLoad priceString=======' + priceString);\n            this._priceString = (priceString);\n            this.setWaitNodeActive(false);\n        }\n\n        setTimeout(() => {\n            this.setWaitNodeActive(false);\n        }, 1000)\n\n        this.setWaitNodeActive(true);\n        PayMgr.instance.requestProductPrices(queryCallbackFunc);\n    },\n\n    init(world ,callback) {\n        this._world = world;\n\n        if (!this._isInit){\n            this.initItems();\n            this._isInit = true;\n        }\n\n        this.callback = callback\n    },\n\n    setWaitNodeActive: function (isActive) {\n        this.waitNode.active = isActive;\n    },  \n\n    initItems() {\n        const shopDatas = ConfigData.instance.getShopDatas();\n        for (let i = 0; i < shopDatas.length; i++) {\n            const data = shopDatas[i];\n            var itemNode = cc.instantiate(this.itemPrefab);\n            itemNode.parent = this.content;\n            itemNode.active = true;\n            var itemNodeSc = itemNode.getComponent('ItemShopItem');\n            itemNodeSc.init(data, this._world);\n            if (data.iconIndex && this.iconSpriteFrames[data.iconIndex]) {\n                itemNodeSc.resetIcon(this.iconSpriteFrames[data.iconIndex])\n            }\n            this._itemNodes.push(itemNode);\n        }\n\n        this.resetPrices(this._priceString);\n    },\n\n\n\n    resetPrices: function (priceString) {\n        console.log(\"priceString==> \",priceString)\n        if (!priceString) return;\n        if (priceString === \"\") return;\n        var splitStr = PlatformMgr.isIosApp() ? '?' : '#';\n        var prices = priceString.split(splitStr);\n\n        var pricesnew = [];\n        for (let index = 0; index < prices.length; index++) {\n            let price = prices[index]\n            if(prices[index].includes(\"2.99\")){\n                continue;\n            }\n            pricesnew.push(price)\n        }\n\n        for (let i = 0; i < this._itemNodes.length; i++) {\n            var itemNode = this._itemNodes[i];\n            var itemNodeSc = itemNode.getComponent('ItemShopItem');\n            if (i >= pricesnew.length) break;\n            console.log(\"价格\",pricesnew[i])\n            itemNodeSc.resetPrice(pricesnew[i]);\n        }\n    },\n\n    close() {\n        this.node.active = false;\n        if (this.callback) {\n            this.callback();\n            this.callback = null\n        }\n    },\n\n    update(dt) {\n        if (PlatformMgr.isIosApp()&&!this.waitNode.active && PayMgr.instance.getIsPaying()) {\n            this.setWaitNodeActive(true);\n        }\n\n        if (PlatformMgr.isIosApp()&&this.waitNode.active && !PayMgr.instance.getIsPaying()) {\n            this.setWaitNodeActive(false);\n        }\n    },\n\n    // update (dt) {},\n});"]}