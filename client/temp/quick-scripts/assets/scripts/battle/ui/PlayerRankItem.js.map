{"version":3,"sources":["PlayerRankItem.js"],"names":["Tools","require","TEAM_COLOR","UIUtil","PlayerRankItem","cc","Class","extends","Component","properties","rankSpr","Sprite","playerName","Label","playerScore","flagIcon","_rank","_needUpdate","_speed","_knifeNum","hashTag","Node","rankLabel","effectNode","activeNode","_isDead","_time","init","entityPlayer","langFlag","tid","teamID","node","color","string","name","isLocal","loadResFlag","country","_player","_height","height","setNewRank","newRank","_lastY","_newY","_curY","y","update","dt","active","isDead","nameDirty","rank","getKnifeNum","misc","lerp","isFloatEqual"],"mappings":"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","file":"PlayerRankItem.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\battle\\ui","sourcesContent":["/**\n * @fileoverview 玩家名次Item\n * @author meifan@gameley.cn (梅凡)\n */\n\nconst Tools = require('Tools');\nconst TEAM_COLOR = require('Types').TEAM_COLOR;\nconst UIUtil = require('UIUtil');\nconst PlayerRankItem = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        rankSpr: cc.Sprite,\n        playerName: cc.Label,\n        playerScore: cc.Label,\n        flagIcon: cc.Sprite,\n        _rank: 0,\n        _needUpdate: false,\n        _speed: 2,\n        _knifeNum: 0,\n        hashTag: cc.Node,\n        rankLabel: cc.Label,\n        effectNode: cc.Node,\n        activeNode: cc.Node,\n        _isDead: false,\n        _time: 0.1,\n    },\n\n    init: function (entityPlayer) {\n\n        this.playerName.langFlag = true;\n\n        const tid = entityPlayer.teamID;\n        this.rankSpr.node.color = TEAM_COLOR[tid];\n        this.hashTag.color = TEAM_COLOR[tid];\n        this.rankLabel.node.color = TEAM_COLOR[tid];\n        this.playerName.string = entityPlayer.name;\n        this.playerName.node.color = entityPlayer.isLocal ? TEAM_COLOR[tid] : TEAM_COLOR[0];\n        UIUtil.loadResFlag(this.flagIcon, entityPlayer.country);\n\n        this._player = entityPlayer;\n        this.playerScore.string = 0;\n\n        this._needUpdate = false;\n        this._height = this.node.height;\n        this._speed = 0.3;\n\n        this._isDead = false;\n        this._time = 0.1;\n\n        this.setNewRank(tid);\n    },\n\n    setNewRank: function (newRank) {\n        if (newRank !== this._rank) {\n            this._lastY = -this._height * this._rank;\n            this._newY = -this._height * newRank;\n            this._curY = this.node.y;\n            this._rank = newRank;\n            this._needUpdate = true;\n\n            this.rankLabel.string = this._rank;\n        }\n    },\n\n    update: function (dt) {\n        if (this._isDead) {\n            if (this._time <= 0) {\n                this._time = 0;\n                this.activeNode.active = false;\n                this.playerName.node.active = false;\n            } else {\n                this._time -= dt;\n            }\n            return;\n        }\n\n        if (this._isDead !== this._player.isDead) {\n            this._isDead = this._player.isDead;\n            this.effectNode.active = true;\n            return;\n        }\n\n        if (this._player.nameDirty) {\n            this.playerName.string = this._player.name;\n            this._player.nameDirty = false;\n        }\n\n        if (this._rank !== this._player.rank) {\n            this.setNewRank(this._player.rank);\n        }\n\n        if (this._knifeNum !== this._player.getKnifeNum()) {\n            this._knifeNum = this._player.getKnifeNum();\n            this.playerScore.string = this._knifeNum;\n        }\n\n        if (this._needUpdate) {\n            this._curY = cc.misc.lerp(this._curY, this._newY, this._speed);\n            // cc.log(' this._curY: ' +  this._curY + ' newY: ' +  this._newY);\n            if (Tools.isFloatEqual(this._curY, this._newY)) {\n                this._needUpdate = false;\n                this.node.y = this._newY;\n                this.playerName.node.y = this._newY;\n            } else {\n                this.node.y = this._curY;\n                this.playerName.node.y = this._curY;\n            }\n        }\n    }\n\n});"]}