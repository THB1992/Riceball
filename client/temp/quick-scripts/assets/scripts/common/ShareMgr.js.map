{"version":3,"sources":["ShareMgr.js"],"names":["PlatformType","require","PlatformMgr","ShareType","Tools","ConfigData","PlayerData","GameData","AudioEngine","mta","ShareMgr","cc","Class","statics","playerUid","shareTime","shareFailCount","init","platformType","query","WECHAT","wx","updateShareMenu","withShareTicket","complete","res","console","log","showShareMenu","showShareItems","imageUrl","onShareAppMessage","title","createQueryString","shareType","shareUid","uid","onShow","JSON","stringify","handleShare","shareTicket","hawkeye_report_share_in","Number","parseInt","scene","setItem","refreshRedDot","setTimeout","k6_userDate","enterScene","isShareing","wxOnShowCallBack","launchData","decodeURIComponent","reg","RegExp","r","match","eolinkerChannelCode","unescape","cid","launchOptions","qq","getLaunchOptionsSync","eolinkerScene","App","isOnShow","getQueryString","undefined","NONE","shareRecord","share_point","share_picture","key","value","BROWSER","share","callback","showUITips","queryObject","shareText","panelParam","msgParam","shareData","instance","getRandomShareBaseData","error","curShareType","getCurTime","closeCallback","success","performance","now","director","_lastUpdate","UnlockSkin","Revive","MultipGold","TryOutSkin","OfflineGold","Sign","RefreshDailyTask","MultipDailyTask","updateDayGetPrizeCount","updateShareScore","checkQueryObject","paramObject","shareStr","screenshotParam","imgWidth","imgHeight","offset","Vec2","ZERO","picName","sharePicture","doPlatformShare","shareID","id","sharePoint","wxShare","loadEolinkerSettings","toString","isNetImage","share_pic","createShareRecord","queryString","stopAllSound","doWxShare","hawkeye_report_share_out","isShareSuccess","showRandomFailTips","isShowLog","shareAppMessage","cancel","QQ","flag","hasOwnProperty","paramStr","ret","getTimestampS","isInReview","handleEolinkerSettings","eolinkerSettings","settings","shareSettings","useSettingsFlag","randomID","share_random","getRandomItem","share_data","share_titles","share_title","length","share_imgs","share_img","fakeShareFlag","HOME","WIN","Friend","data","clientData","shareLimitFailCount","time","allShareCount","shareSuccessWaitTime","successPercent","getItemOrFinalItem","shareSuccessPercents","random","Math","floor","updateShareCount","tips","shareFailTips","str","showModal","content","cancelText","confirmText","confirm"],"mappings":"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","file":"ShareMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\common","sourcesContent":["/**\n * @fileoverview ShareMgr\n * @author <meifan@gameley.cn> (梅凡)\n */\n\nconst PlatformType = require('Types').PlatformType;\nconst PlatformMgr = require('PlatformMgr');\nconst ShareType = require('Types').ShareType;\nconst Tools = require('Tools');\nconst ConfigData = require('ConfigData');\nconst PlayerData = require('PlayerData');\nconst GameData = require('GameData');\nconst AudioEngine = require('AudioEngine');\nconst mta = require('mta_analysis');\n\n/**\n * ShareMgr 分享管理器\n */\nconst ShareMgr = cc.Class({\n    statics: {\n        /** 当前玩家uid，用于分享出口 */\n        playerUid: '',\n        /** 分享时间 */\n        shareTime: '',\n        shareFailCount: 0,\n\n\n        /**\n         * 初始化\n         */\n        init: function () {\n            ShareMgr.platformType = PlatformMgr.platformType;\n            ShareMgr.query = null;\n            // Tools.setItem('fromMyApp', 1);\n            switch (ShareMgr.platformType) {\n                case PlatformType.WECHAT: {\n                    //#region 菜单被动转发\n                    wx.updateShareMenu({\n                        withShareTicket: true,\n                        complete: (res) => {\n                            console.log('updateShareMenu complete:', res);\n                        }\n\n\n                    });\n\n                    wx.showShareMenu({\n                        showShareItems: ['qq', 'qzone']\n                    });\n\n                    PlatformMgr.imageUrl = 'https://k6-cdn.pinduoqian.cn/wechat/share/share001.jpg';\n                    // cc.loader.loadRes(\"texture/share/share001\", cc.SpriteFrame, function (error, data) {\n                    //     if (error) {\n                    //         cc.error(error);\n                    //     } else if (data) {\n                    //         PlatformMgr.imageUrl = data._textureFilename;\n                    //     }\n                    // });\n                    // b3a155dd781578b8831d7a6103cb3eb0\n                    // ShareMgr.handleShare({\n                    //     shareType: 0,\n                    //     shareUid: 106002\n                    // })\n                    wx.onShareAppMessage(() => ({\n                        title: '是时候展现真正的技术了，你的飞刀玩得6不6',\n                        imageUrl: PlatformMgr.imageUrl,\n                        query: ShareMgr.createQueryString({\n                            shareType: 0,\n                            shareUid: PlatformMgr.uid,\n                        })\n                    }))\n\n                    // 从后台点击链接切回的情况\n                    wx.onShow((res) => {\n                        console.log('wx.onShow:', JSON.stringify(res));\n                        // var scene = decodeURIComponent(res.query.scene);\n                        // if (scene) {\n                        //     //通过小程序码进入\n                        //     ShareMgr.shareParam.inviterUid = scene;\n                        //     console.log(scene)\n                        // } \n                        // else {\n\n                        ShareMgr.handleShare(res.query, res.shareTicket, true);\n                        // PlatformMgr.eolinkerShare();\n                        PlatformMgr.hawkeye_report_share_in();\n                        if (Number.parseInt(res.scene) === 1022) {\n                            Tools.setItem('fromMyApp', 1);\n                            if (ShareMgr.refreshRedDot) {\n                                setTimeout(() => {\n                                    ShareMgr.refreshRedDot()\n                                }, 500);\n                            }\n                        };\n\n                        PlatformMgr.k6_userDate();\n\n                        ShareMgr.enterScene = res.scene;\n                        ShareMgr.isShareing = false;\n\n                        if (ShareMgr.wxOnShowCallBack) {\n                            ShareMgr.wxOnShowCallBack();\n                            ShareMgr.wxOnShowCallBack = null;\n                        }\n\n                        if (res.query) {\n                            if (res.query.scene) {\n                                let launchData = decodeURIComponent(res.query.scene);\n                                let reg = new RegExp(\"(^|&)\" + \"cid\" + \"=([^&]*)(&|$)\");\n                                let r = launchData.match(reg);\n                                if (r !== null) {\n                                    PlatformMgr.eolinkerChannelCode = unescape(r[2]);\n\n                                    console.log('eolinkerChannelCode:' + PlatformMgr.eolinkerChannelCode);\n                                }\n                            } else if (res.query.cid) {\n                                PlatformMgr.eolinkerChannelCode = res.query.cid;\n                                console.log('eolinkerChannelCode:' + PlatformMgr.eolinkerChannelCode);\n                            }\n                        }\n                    });\n\n                    const launchOptions = qq.getLaunchOptionsSync();\n                    console.log('-------------launchOptions:', JSON.stringify(launchOptions));\n                    if (Number.parseInt(launchOptions.scene) === 1022) {\n                        Tools.setItem('fromMyApp', 1);\n                        console.log('-------------来自置顶哦！！！-------------');\n                        if (ShareMgr.refreshRedDot) {\n                            ShareMgr.refreshRedDot()\n                        }\n                    }\n                    PlatformMgr.eolinkerScene = launchOptions.scene;\n\n\n                    if (launchOptions && launchOptions.query) {\n\n                        ShareMgr.handleShare(launchOptions.query, launchOptions.shareTicket);\n\n                        if (launchOptions.query.scene) {\n                            let launchData = decodeURIComponent(launchOptions.query.scene);\n                            let reg = new RegExp(\"(^|&)\" + \"cid\" + \"=([^&]*)(&|$)\");\n                            let r = launchData.match(reg);\n                            if (r !== null) {\n                                PlatformMgr.eolinkerChannelCode = unescape(r[2]);\n                                console.log('eolinkerChannelCode:' + PlatformMgr.eolinkerChannelCode);\n                            }\n                        } else if (launchOptions.query.cid) {\n                            PlatformMgr.eolinkerChannelCode = launchOptions.query.cid;\n                            console.log('eolinkerChannelCode:' + PlatformMgr.eolinkerChannelCode);\n                        }\n                    }\n\n\n                    mta.App.init({\n                        \"appID\": \"500681114\",\n                        \"eventID\": \"500681124\", // 高级功能-自定义事件统计ID，配置开通后在初始化处填写\n                        \"lauchOpts\": launchOptions, //渠道分析,需在onLaunch方法传入options,如onLaunch:function(options){...}\n                        \"autoReport\": true, //开启自动上报\n                        \"statParam\": true, //每个页面均加入参数上报\n                        \"ignoreParams\": [], //statParam 为 true 时，如果不想上报的参数可配置忽略\n                    });\n\n                    break;\n                }\n\n                default: {\n                    break;\n                }\n            }\n\n        },\n\n        /**\n         * 处理分享，玩家点击分享链接进入游戏时，需要根据链接透传参数进行处理\n         * @param {Object} query 分享透传参数\n         * @param {string} shareTicket 微信分享shareTicket\n         * @param {boolean} isOnShow 是否是在后台时点击分享链接进入的\n         */\n        handleShare: function (query, shareTicket, isOnShow) {\n            ShareMgr.query = query;\n\n            var shareType = ShareMgr.getQueryString('shareType');\n            if (shareType == null || shareType == undefined) {\n                return;\n            }\n            // 分享类型\n            shareType = parseInt(shareType);\n            if (shareType === ShareType.NONE) {\n                return;\n            }\n            console.log('-------分享query-------', JSON.stringify(query));\n            console.log('分享类型:' + shareType);\n\n            PlatformMgr.shareType = shareType;\n            PlatformMgr.shareRecord = ShareMgr.getQueryString('shareRecord');\n            PlatformMgr.share_point = ShareMgr.getQueryString('share_point');\n            PlatformMgr.share_picture = ShareMgr.getQueryString('share_picture');\n            PlatformMgr.shareUid = ShareMgr.getQueryString('shareUid');\n        },\n\n        /**\n         * 从分享透传参数中获取具体数据\n         * @param {key} 透传参数key\n         * @returns {any} 透传参数value\n         */\n        getQueryString: function (key) {\n            switch (ShareMgr.platformType) {\n                case PlatformType.WECHAT:\n                // case PlatformType.QQ:\n                {\n                    if (ShareMgr.query) {\n                        const value = ShareMgr.query[key];\n                        if (value != undefined) {\n                            return value;\n                        }\n                    }\n                    return null;\n                }\n                case PlatformType.BROWSER: {\n                    return Tools.getQueryString(key);\n                }\n                default:\n                    return null;\n            }\n        },\n\n        /**\n         * 分享，游戏业务层绝大部分时间应调用此接口进行分享\n         * @param {ShareType} shareType 分享类型\n         * @param {Object} queryObject 分享透传参数\n         * @param {string} shareText 分享标题\n         * @param {Object} panelParam UI展示数据参数\n         * @param {function} callback 分享回调\n         * @param {string} msgParam 上行给服务器的自定义参数，依照分享类型区分\n         * @param {boolean} callback.isSuccess 是否分享成功\n         */\n        share: function (shareType, callback = null, showUITips = false, queryObject = null, shareText = null, panelParam = null, msgParam = \"\") {\n            const shareData = ConfigData.instance.getRandomShareBaseData(shareType);\n            if (!shareData) {\n                console.error('Can\\'t find shareData with shareType:' + shareType);\n                return;\n            }\n\n            ShareMgr.curShareType = shareType;\n            ShareMgr.shareTime = PlayerData.instance.getCurTime();\n\n            let closeCallback = (success) => {\n\n                if (performance && performance.now) {\n                    cc.director._lastUpdate = performance.now();\n                }\n                \n                if (success) {\n                    switch (shareType) {\n                        case ShareType.UnlockSkin:\n                        case ShareType.Revive:\n                        case ShareType.MultipGold:\n                        case ShareType.TryOutSkin:\n                        case ShareType.OfflineGold:\n                        case ShareType.Sign:\n                        case ShareType.RefreshDailyTask:\n                        case ShareType.MultipDailyTask:\n                            PlayerData.instance.updateDayGetPrizeCount('分享');\n                            PlayerData.instance.updateShareScore();\n                            break;\n                        default:\n                            break;\n                    }\n                }\n                if (callback) callback(success)\n            }\n\n            queryObject = ShareMgr.checkQueryObject(queryObject, shareType);\n            const paramObject = {\n                queryObject: queryObject,\n                shareText: shareText ? shareText : shareData.shareStr,\n                panelParam: panelParam,\n                shareData: shareData,\n                imageUrl: shareData.imageUrl,\n                callback: closeCallback,\n                showUITips: showUITips,\n                msgParam: msgParam,\n                screenshotParam: {\n                    imgWidth: 500,\n                    imgHeight: 400,\n                    offset: cc.Vec2.ZERO,\n                },\n                picName: shareData.sharePicture\n            };\n            if (!paramObject.imageUrl) {\n                paramObject.imageUrl = '';\n            }\n            ShareMgr.doPlatformShare(paramObject);\n        },\n\n\n        /**\n         * 检查并补齐分享透传参数\n         * @param {Object} queryObject 分享透传参数\n         * @param {ShareType} shareType 分享类型\n         * @returns {Object} 补齐后的透传参数\n         */\n        checkQueryObject: function (queryObject, shareType) {\n            if (queryObject === undefined || queryObject === null) {\n                queryObject = {};\n            }\n            if (queryObject.shareType === undefined) {\n                queryObject.shareType = shareType;\n            }\n            if (queryObject.uid === undefined) {\n                queryObject.shareUid = PlatformMgr.uid;\n            }\n            return queryObject;\n        },\n        /**\n         * 调用平台接口进行分享\n         * @param {Object} paramObject 参数\n         * @param {string} paramObject.shareText 分享标题\n         * @param {Object} paramObject.queryObject 分享透传参数\n         * @param {Object} paramObject.panelParam UI展示数据参数\n         * @param {ShareType} paramObject.queryObject.shareType 分享类型\n         * @param {ShareData} paramObject.queryObject.shareData 分享配置数据\n         * @param {function} paramObject.callback 回调\n         * @param {boolean} paramObject.callback.isSuccess 是否分享成功\n         * @param {Object} paramObject.screenshotParam 截屏参数\n         * @param {Number} paramObject.screenshotParam.imgWidth 截屏宽度\n         * @param {Number} paramObject.screenshotParam.imgHeight 截屏高度\n         * @param {cc.Vec2} paramObject.screenshotParam.offset 偏移\n         */\n        doPlatformShare: function (paramObject) {\n            var shareText = paramObject.shareText;\n            const queryObject = paramObject.queryObject;\n            const shareType = queryObject.shareType;\n            const shareData = paramObject.shareData;\n            const msgParam = paramObject.msgParam;\n            if (queryObject.shareID === undefined) {\n                queryObject.shareID = shareData.id;\n            }\n            if (queryObject.share_point === undefined) {\n                queryObject.share_point = shareData.sharePoint;\n            }\n            // let queryString = ShareMgr.createQueryString(queryObject);\n\n            switch (ShareMgr.platformType) {\n                // 微信小游戏分享\n                case PlatformType.WECHAT: {\n                    if (ShareMgr.isShareing) return;\n                    ShareMgr.isShareing = true;\n\n                    ShareMgr.wxShare = () => {\n                        ShareMgr.loadEolinkerSettings(shareType.toString(), shareText,\n                            paramObject.imageUrl, paramObject.picName, (title, imageUrl, isNetImage, share_pic) => {\n                                if (queryObject.share_picture === undefined) {\n                                    queryObject.share_picture = share_pic;\n                                }\n                                if (queryObject.shareRecord === undefined) {\n                                    queryObject.shareRecord = ShareMgr.createShareRecord();\n                                }\n\n                                let queryString = ShareMgr.createQueryString(queryObject);\n                                // if (isNetImage) {\n                                AudioEngine.instance.stopAllSound();\n                                ShareMgr.doWxShare(paramObject, title, imageUrl, queryString);\n                                // } else {\n                                //     cc.loader.loadRes(imageUrl, cc.SpriteFrame, function (error, data) {\n                                //         if (error) {\n                                //             cc.error(error);\n                                //         } else if (data) {\n                                //             ShareMgr.doWxShare(paramObject, title, data._textureFilename, queryString);\n                                //         }\n                                //     });\n                                // }\n                                PlatformMgr.hawkeye_report_share_out(shareType, share_pic);\n                            });\n                    }\n\n                    ShareMgr.wxShare();\n                    break;\n                }\n                // 浏览器分享，复制链接到剪切板\n                case PlatformType.BROWSER: {\n                    if (queryObject.share_picture === undefined) {\n                        queryObject.share_picture = paramObject.picName;\n                    }\n                    if (queryObject.shareRecord === undefined) {\n                        queryObject.shareRecord = ShareMgr.createShareRecord();\n                        console.log('shareRecord: ' + queryObject.shareRecord);\n                    }\n                    let queryString = ShareMgr.createQueryString(queryObject);\n                    // if (paramObject.captureCallback) {\n                    //     paramObject.captureCallback();\n                    // }\n                    // queryString = Tools.getUrlWithoutQueryString() + `?${queryString}`;\n                    // Tools.webCopyString(queryString);\n                    // ShareMgr.uiMgr.showTipMsgBox(9);\n                    if (paramObject.callback) {\n                        paramObject.callback(true);\n                    }\n                    break;\n                }\n                default:\n                    break;\n            }\n        },\n\n        doWxShare: function (paramObject, title, imageUrl, queryString) {\n            ShareMgr.wxOnShowCallBack = function () {\n                if (ShareMgr.isShareSuccess()) {\n                    if (paramObject.callback) {\n                        paramObject.callback(true);\n                    }\n                    if (paramObject.showUITips) {\n                        paramObject.showUITips(true);\n                    }\n                    ShareMgr.shareFailCount = 0;\n                } else {\n                    if (paramObject.showUITips) {\n                        paramObject.showUITips(false);\n                        if (paramObject.callback) {\n                            paramObject.callback(false);\n                        }\n                    } else {\n                        ShareMgr.showRandomFailTips(paramObject.callback);\n                    }\n                }\n            }\n            if (GameData.instance.isShowLog()) {\n                console.log('------------最终分享query-------------', queryString)\n            }\n\n            wx.shareAppMessage({\n                title: title,\n                imageUrl: imageUrl,\n                query: queryString,\n                complete: function () {\n                    console.log('完成')\n                },\n                cancel: function () {\n                    console.log('取消')\n                }\n            })\n        },\n\n        /**\n         * 创建透传参数字符串，用于分享出口\n         * @param {Object} queryObject 分享透传参数\n         * @returns {string} 透传参数字符串\n         */\n        createQueryString: function (queryObject) {\n            let queryString = ''\n            switch (ShareMgr.platformType) {\n                case PlatformType.QQ: {\n                    queryString = JSON.stringify(queryObject);\n                    break;\n                }\n                default: {\n                    let flag = true;\n                    for (var key in queryObject) {\n                        if (queryObject.hasOwnProperty(key)) {\n                            const paramStr = `${key}=${queryObject[key]}`;\n                            if (flag) {\n                                flag = false;\n                                queryString = paramStr;\n                            } else {\n                                queryString += `&${paramStr}`;\n                            }\n                        }\n                    }\n                    break;\n                }\n            }\n            // console.log('---------query:' + queryString);\n            return queryString;\n        },\n\n        /**\n         * 生成shareRecard\n         */\n        createShareRecord: function () {\n            var ret = '';\n\n            if (PlatformMgr.uid) {\n                ret += '' + PlatformMgr.uid + 'a';\n            }\n            ret += '' + Tools.getTimestampS();\n\n            return ret;\n        },\n\n\n        loadEolinkerSettings: function (shareType, title, imageUrl, picName, callback) {\n            switch (ShareMgr.platformType) {\n                // 微信小游戏分享\n                case PlatformType.WECHAT: {\n\n                    if (GameData.instance.isInReview) {\n                        if (callback) callback(title, imageUrl, false, picName);\n                    } else {\n                        // PlatformMgr.updateEolinkerSettings((settings) => {\n                        var ret = ShareMgr.handleEolinkerSettings(PlatformMgr.eolinkerSettings, shareType, title, imageUrl, picName);\n                        if (callback) callback(ret.title, ret.imageUrl, ret.isNetImage, ret.picName);\n                        // });\n                    }\n                    break;\n                }\n                default: {\n                    if (callback) callback(title, imageUrl, false, picName);\n                    break;\n                }\n            }\n        },\n\n        handleEolinkerSettings: function (settings, shareType, title, imageUrl, picName) {\n            // console.log('shareID:' + shareID);\n            // if (GameData.instance.isShowLog()) {\n            // console.log('settings:' + JSON.stringify(settings));\n            // }\n            // TODO 分享使用下发的图片和文字\n            var isNetImage = false;\n            var shareSettings = settings ? settings : {};\n            var useSettingsFlag = shareSettings.useSettingsFlag == 'true';\n            var randomID = -1;\n            if (useSettingsFlag) {\n                if (shareSettings.share_random) {\n                    if (shareSettings.share_random[shareType]) {\n                        randomID = Tools.getRandomItem(shareSettings.share_random[shareType]);\n\n                        if (randomID >= 0) {\n                            if (shareSettings.share_data && shareSettings.share_data[randomID]) {\n                                if (shareSettings.share_data[randomID][0]) {\n                                    title = shareSettings.share_data[randomID][0];\n                                }\n                                if (shareSettings.share_data[randomID][1]) {\n                                    imageUrl = shareSettings.share_data[randomID][1];\n                                    isNetImage = true;\n                                }\n                                if (shareSettings.share_data[randomID][2]) {\n                                    picName = shareSettings.share_data[randomID][2];\n                                }\n                            }\n                        }\n                    }\n                } else if (shareSettings.share_titles && typeof shareSettings.share_titles[shareType] == 'string') {\n                    title = shareSettings.share_titles[shareType];\n                } else if (shareSettings.share_title !== undefined && shareSettings.share_title.length > 0) {\n                    title = shareSettings.share_title;\n                }\n\n                if (shareSettings.share_imgs && typeof shareSettings.share_imgs[shareType] == 'string') {\n                    imageUrl = shareSettings.share_imgs[shareType];\n                    isNetImage = true;\n                } else if (shareSettings.share_img !== undefined && shareSettings.share_img.length > 0) {\n                    imageUrl = shareSettings.share_img;\n                    isNetImage = true;\n                }\n\n                if (shareSettings.fakeShareFlag !== undefined) {\n                    ShareMgr.fakeShareFlag = shareSettings.fakeShareFlag;\n                }\n            }\n\n            if (GameData.instance.isShowLog()) {\n                console.log('shareType:' + shareType + ' shareTitle:' + title + ' shareImg:' + imageUrl);\n            }\n            return {\n                title: title,\n                imageUrl: imageUrl,\n                isNetImage: isNetImage,\n                picName: picName\n            };\n        },\n\n\n        isShareSuccess: function () {\n            if (ShareMgr.fakeShareFlag === 'false') return true;\n            if (GameData.instance.isInReview) return true;\n            if (ShareMgr.curShareType === ShareType.HOME || ShareMgr.curShareType === ShareType.WIN || ShareMgr.curShareType === ShareType.Friend) return true;\n\n            var data = ConfigData.instance.clientData;\n            //根据失败次数判断\n            if (ShareMgr.shareFailCount >= data.shareLimitFailCount) {\n                if (GameData.instance.isShowLog()) {\n                    console.log('失败次数:', ShareMgr.shareFailCount, '大于等于', data.shareLimitFailCount, '次  此次必定成功')\n                }\n                return true;\n            }\n\n            //根据分享时间判断\n            var time = PlayerData.instance.getCurTime() - ShareMgr.shareTime;\n            if (GameData.instance.isShowLog()) {\n                console.log('本次分享时间：', time);\n                console.log('本次分享累计失败次数：', ShareMgr.shareFailCount);\n                console.log('本次游戏分享累计次数：', PlayerData.instance.allShareCount);\n            }\n            if (time > (data.shareSuccessWaitTime * 1000)) {\n                var successPercent = Tools.getItemOrFinalItem(data.shareSuccessPercents, PlayerData.instance.allShareCount);\n                var random = Math.floor((Math.random() * 100));\n                PlayerData.instance.updateShareCount();\n                if (random < successPercent) {\n                    if (GameData.instance.isShowLog()) {\n                        console.log('分享概率成功:' + random + ' < ' + successPercent);\n                    }\n                    return true;\n                } else {\n                    if (GameData.instance.isShowLog()) {\n                        console.log('分享概率失败:' + random + ' > ' + successPercent);\n                    }\n                    ShareMgr.shareFailCount++;\n                    return false;\n                }\n            } else {\n                if (GameData.instance.isShowLog()) {\n                    console.log('分享未过' + data.shareSuccessWaitTime + '秒，失败:' + time)\n                }\n                return false;\n            }\n        },\n\n\n        showRandomFailTips: function (callback) {\n            var tips = ConfigData.instance.clientData.shareFailTips;\n            var str = Tools.getRandomItem(tips);\n            wx.showModal({\n                title: '提示',\n                content: str,\n                cancelText: '知道了',\n                confirmText: '重新分享',\n                success(res) {\n                    if (res.confirm) {\n                        ShareMgr.wxShare();\n                    } else {\n                        if (callback) callback(false);\n                    }\n                }\n            })\n\n\n        },\n\n\n\n\n    },\n});"]}