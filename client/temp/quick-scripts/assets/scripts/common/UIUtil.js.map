{"version":3,"sources":["UIUtil.js"],"names":["PlatformMgr","require","PlatformType","PlayerData","UIUtil","cc","Class","extends","Component","statics","loadResSprite","sprite","url","loader","loadRes","SpriteFrame","error","resource","spriteFrame","loadFriendPortrait","Number","newUrl","iconUrl","load","type","loadResPortrait","player","isLocal","instance","platformType","WECHAT","includes","Math","random","loadAIPortrait","loadResFlag","_getResUuid","loadUIPrefab","prefabPath","callback","Prefab","instantiate"],"mappings":"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","file":"UIUtil.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\common","sourcesContent":["const PlatformMgr = require('PlatformMgr');\r\nconst PlatformType = require('Types').PlatformType;\r\nconst PlayerData = require('PlayerData');\r\nvar UIUtil = cc.Class({\r\n    extends: cc.Component,\r\n    statics: {\r\n        loadResSprite: function (sprite, url) {\r\n            cc.loader.loadRes(url, cc.SpriteFrame, (error, resource) => {\r\n                if (error) {\r\n                    cc.error(error);\r\n                } else if (resource) {\r\n                    sprite.spriteFrame = resource;\r\n                }\r\n            })\r\n        },\r\n\r\n        loadFriendPortrait: function (sprite, url) {\r\n            if (!url) return;\r\n            if (Number(url)) {\r\n                var newUrl = \"texture/defaultPortrait/avatar-player-0\" + url;\r\n                cc.loader.loadRes(newUrl, cc.SpriteFrame, (error, resource) => {\r\n                    if (error) {\r\n                        cc.error(error);\r\n                    } else if (resource) {\r\n                        if (sprite.iconUrl === url) {\r\n                            sprite.spriteFrame = resource;\r\n                        }\r\n                    }\r\n                })\r\n            } else {\r\n                cc.loader.load({\r\n                    url: url,\r\n                    type: 'jpg',\r\n                }, (error, resource) => {\r\n                    if (error) {\r\n                        cc.error(error);\r\n                    } else if (resource) {\r\n                        if (sprite.iconUrl === url) {\r\n                            sprite.spriteFrame = new cc.SpriteFrame(resource);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @param  {} sprite\r\n         * @param  {} player\r\n         * @param  {} needCheck 需要检测加载好的是不是当前需要显示的头像\r\n         */\r\n        loadResPortrait: function (sprite, player) {\r\n            if (player.isLocal) {\r\n                var url = PlayerData.instance.iconUrl;\r\n                if (Number(url)) {\r\n                    var newUrl = \"texture/defaultPortrait/avatar-player-0\" + url;\r\n                    cc.loader.loadRes(newUrl, cc.SpriteFrame, (error, resource) => {\r\n                        if (error) {\r\n                            cc.error(error);\r\n                        } else if (resource) {\r\n                            if (!sprite.iconUrl || sprite.iconUrl === url) {\r\n                                sprite.spriteFrame = resource;\r\n                            }\r\n                        }\r\n                    })\r\n                } else {\r\n                    if (PlatformMgr.platformType === PlatformType.WECHAT) {\r\n                        var newUrl = '';\r\n                        if (url.includes('?')) {\r\n                            newUrl = url + '&t=' + Math.random();\r\n                        } else {\r\n                            newUrl = url + '?t=' + Math.random();\r\n                        }\r\n                        cc.loader.load({\r\n                            url: newUrl,\r\n                            type: 'jpg',\r\n                        }, (error, resource) => {\r\n                            if (error) {\r\n                                cc.error(error);\r\n                            } else if (resource) {\r\n                                if (!sprite.iconUrl || sprite.iconUrl === url) {\r\n                                    sprite.spriteFrame = new cc.SpriteFrame(resource);\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            } else {\r\n                var newUrl = \"texture/portrait/pic\" + player.iconUrl;\r\n                cc.loader.loadRes(newUrl, cc.SpriteFrame, (error, resource) => {\r\n                    if (error) {\r\n                        cc.error(error);\r\n                    } else if (resource) {\r\n                        if (!sprite.iconUrl || sprite.iconUrl === player.iconUrl) {\r\n                            sprite.spriteFrame = resource;\r\n                        }\r\n                    }\r\n                })\r\n            }\r\n        },\r\n\r\n\r\n        loadAIPortrait: function (sprite, url) {\r\n            var newUrl = \"texture/portrait/pic\" + url;\r\n            cc.loader.loadRes(newUrl, cc.SpriteFrame, (error, resource) => {\r\n                if (error) {\r\n                    cc.error(error);\r\n                } else if (resource) {\r\n                    if (sprite.iconUrl === url) {\r\n                        sprite.spriteFrame = resource;\r\n                    }\r\n                }\r\n            })\r\n        },\r\n\r\n\r\n        loadResFlag: function (sprite, url) {\r\n            var newUrl = \"texture/flag/flag-US\";\r\n            if (url) {\r\n                newUrl = \"texture/flag/flag-\" + url;\r\n            }\r\n            if(!cc.loader._getResUuid(newUrl, cc.SpriteFrame)) {\r\n                newUrl = \"texture/flag/flag-unknown\";\r\n            }\r\n\r\n            UIUtil.loadResSprite(sprite, newUrl);\r\n        },\r\n\r\n\r\n\r\n        loadUIPrefab: function (prefabPath, callback) {\r\n            cc.loader.loadRes(prefabPath, cc.Prefab, (error, resource) => {\r\n                if (error) {\r\n                    cc.error(error);\r\n                    if (callback) {\r\n                        callback(null);\r\n                    }\r\n                } else {\r\n                    if (resource) {\r\n                        if (callback) {\r\n                            callback(cc.instantiate(resource));\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    // update (dt) {},\r\n});"]}